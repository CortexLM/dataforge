# Vulnerability Injection Prompts

Prompt templates for injecting realistic security vulnerabilities into generated code. These prompts guide agents to create subtle, realistic flaws that mirror real-world security issues.

## Overview

The vulnerability injection system adds security flaws to otherwise clean code in ways that:
- Look like genuine developer mistakes
- Are subtle enough to challenge security reviewers
- Cover a wide range of vulnerability categories
- Scale in difficulty from obvious to deeply hidden

## Directory Structure

```
vulnerability-injection/
├── README.md           # This file
├── injection-guide.md  # Detailed vulnerability patterns
└── cleaning-guide.md   # Post-injection code cleanup
```

## Purpose

Generated vulnerabilities serve as training data for:
- Security scanning tools
- Code review AI systems
- Developer security education
- Penetration testing exercises

## Vulnerability Categories

### Injection Flaws (CWE-74, CWE-89, CWE-79)
SQL injection, command injection, XSS, template injection

### Authentication Issues (CWE-287, CWE-384)
Broken auth, session issues, credential management

### Access Control (CWE-284, CWE-639)
Broken access control, IDOR, privilege escalation

### Cryptographic Failures (CWE-327, CWE-328)
Weak algorithms, improper key management, insufficient randomness

### Security Misconfiguration (CWE-16)
Insecure defaults, missing hardening, verbose errors

### Data Exposure (CWE-200, CWE-312)
Sensitive data leaks, insecure storage, logging secrets

### Memory Safety (CWE-119, CWE-416)
Buffer overflows, use-after-free, integer overflows

### Race Conditions (CWE-362, CWE-367)
TOCTOU, concurrent access issues

## Difficulty Levels

### Easy (Score 1-3)
- Vulnerability is obvious in code review
- Single file, single location
- Common, well-documented pattern
- Example: Direct SQL string concatenation

### Medium (Score 4-6)
- Requires careful analysis to spot
- May span multiple files
- Less common patterns
- Example: Second-order SQL injection

### Hard (Score 7-10)
- Requires deep code understanding
- Subtle patterns or edge cases
- Chain of vulnerabilities
- Example: Type juggling combined with auth bypass

## Integration with Pipeline

```
┌──────────────────┐
│ Clean Generated  │
│ Code             │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐     ┌─────────────────────┐
│ Vulnerability    │────▶│ injection-guide.md  │
│ Injector Agent   │     │ (patterns & examples)│
└────────┬─────────┘     └─────────────────────┘
         │
         ▼
┌──────────────────┐     ┌─────────────────────┐
│ Code Cleaner     │────▶│ cleaning-guide.md   │
│ Agent            │     │ (remove traces)     │
└────────┬─────────┘     └─────────────────────┘
         │
         ▼
┌──────────────────┐
│ Final Benchmark  │
│ Workspace        │
└──────────────────┘
```

## Key Principles

### 1. Realism
Vulnerabilities should look like genuine mistakes, not intentional backdoors.

### 2. Subtlety
Avoid patterns that are immediately flagged by basic static analysis.

### 3. Variety
Distribute vulnerabilities across categories to ensure benchmark diversity.

### 4. Traceability
Maintain metadata about injected vulnerabilities for evaluation purposes.

## Reference Standards

- **CWE**: Common Weakness Enumeration
- **OWASP Top 10**: Web application security risks
- **SANS Top 25**: Most dangerous software errors
- **CVE Database**: Real-world vulnerability examples

## See Also

- [injection-guide.md](injection-guide.md) - Detailed injection patterns
- [cleaning-guide.md](cleaning-guide.md) - Code cleanup guidelines
- [../workspace-generation/](../workspace-generation/) - Code generation prompts
- [../debate/](../debate/) - Quality refinement through debate
