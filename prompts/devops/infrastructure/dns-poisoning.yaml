id: "devops-infra-dns-poisoning-001"
version: "2.0.0"
category: "devops"
subcategory: "infrastructure"

# === LLM GENERATION FRAMEWORK ===
generation_framework:
  multi_conversation_workflow:
    phase_1_research: "Research obscure DNS attack vectors and protocol vulnerabilities"
    phase_2_creation: "Create complex multi-zone DNS scenarios with subtle misconfigurations"
    phase_3_amplification: "Add cascading attack scenarios with forensic requirements"
    phase_4_verification: "Validate task requires production-level DNS security expertise"
  
  complexity_targets:
    minimum_unique_tasks: 10000
    difficulty_range: ["medium", "hard", "expert", "nightmare"]
    domain_expertise_required: ["dns_security", "network_security", "cryptography", "incident_response"]
  
  task_generation_rules:
    - "Combine 3+ attack vectors per task"
    - "Include real DNS incident references"
    - "Require multi-layer defense implementation"
    - "Add compliance and audit requirements"
    - "Include forensic analysis components"
  
  phase_4_verification:
    requirements:
      - "Has at least 5 interacting hidden traps"
      - "Has cascading failures across infrastructure layers (network, compute, storage)"
      - "Requires knowledge of cloud provider internals and Kubernetes scheduler"
      - "Would take experienced SREs 30+ minutes"

# SWE-bench_Pro style fields
problem_statement: |
  DNS infrastructure is vulnerable to attacks:
  
  1. DNS cache poisoning
  2. DNS hijacking via registrar compromise
  3. DNS rebinding attacks
  4. Subdomain takeover
  5. Zone transfer exposure
  6. DNSSEC misconfiguration
  7. DNS amplification/reflection
  8. DNS tunneling
  9. BGP hijacking affecting DNS
  10. Phantom domain attacks

requirements: |
  - Implement DNSSEC
  - Secure registrar accounts
  - Prevent DNS rebinding
  - Audit subdomain ownership
  - Restrict zone transfers
  - Configure DNS firewalls
  - Implement monitoring
  - Set up anomaly detection
  - Configure redundancy
  - Document incident response

interface: |
  Input: DNS configuration and zone files
  Output: Hardened DNS infrastructure
  Validation: DNS attacks blocked, DNSSEC validated

# === COMPREHENSIVE TOPIC UNIVERSE ===
# 100+ detailed topics for DNS security scenarios
topic_universe:
  # DNS Protocol Fundamentals (25 topics)
  dns_protocol:
    record_types:
      - a_aaaa_records: |
          Address records:
          - A record: IPv4 address mapping
          - AAAA record: IPv6 address mapping
          - Multiple records for load balancing
          - TTL considerations for failover
          - Anycast implications
          Security:
          - Validate address ownership
          - Monitor for unauthorized changes
          - Implement change management
      
      - cname_records: |
          Canonical name records:
          - Alias one domain to another
          - Cannot coexist with other records at apex
          - Subdomain takeover vector
          - Chain resolution
          Security risks:
          - CNAME pointing to third-party
          - Dangling CNAME takeover
          - Infinite loop potential
      
      - mx_records: |
          Mail exchange records:
          - Priority-based mail routing
          - Multiple MX for redundancy
          - SPF/DKIM/DMARC integration
          Security:
          - Null MX for non-mail domains
          - Monitor for hijacking
          - Verify MX targets
      
      - txt_records: |
          Text records:
          - SPF records for email
          - DKIM public keys
          - DMARC policies
          - Domain verification
          - CAA for certificates
          Security:
          - Limit TXT record exposure
          - Validate verification tokens
          - Remove obsolete records
      
      - srv_records: |
          Service records:
          - Service discovery (LDAP, SIP, XMPP)
          - Priority and weight
          - Port specification
          Security:
          - Restrict service exposure
          - Internal vs external services
      
      - ns_records: |
          Nameserver records:
          - Zone delegation
          - Glue records
          - Multiple NS for redundancy
          Security:
          - Verify NS ownership
          - Monitor for hijacking
          - Lame delegation detection
      
      - soa_records: |
          Start of Authority:
          - Zone configuration
          - Serial number management
          - Refresh/retry/expire timers
          - Minimum TTL
          Security:
          - Appropriate timer values
          - Serial number monotonicity
      
      - ptr_records: |
          Pointer records (reverse DNS):
          - IP to hostname mapping
          - Email delivery verification
          - Security logging
          Security:
          - Match forward DNS
          - ISP coordination required
      
      - caa_records: |
          Certificate Authority Authorization:
          - Restrict certificate issuance
          - Specify allowed CAs
          - Issue/wild tags
          - Iodef for violation reports
          Security:
          - Mandatory for all domains
          - Monitor CT logs
      
      - dnskey_ds_records: |
          DNSSEC records:
          - DNSKEY: Zone signing keys
          - DS: Delegation signer
          - RRSIG: Record signatures
          - NSEC/NSEC3: Authenticated denial
    
    resolution_process:
      - recursive_resolution: |
          Recursive resolver behavior:
          - Client query to resolver
          - Iterative queries to authoritative
          - Caching at each level
          - TTL-based expiration
          Attack vectors:
          - Cache poisoning
          - Query injection
          - Response manipulation
      
      - iterative_resolution: |
          Authoritative response flow:
          - Root server referral
          - TLD server referral
          - Authoritative answer
          Security:
          - Validate referrals
          - DNSSEC chain
      
      - caching_behavior: |
          DNS cache mechanics:
          - TTL-based caching
          - Minimum TTL enforcement
          - Cache pollution attacks
          - Prefetching
          Security:
          - Appropriate TTL values
          - Cache validation
          - DNSSEC validation
      
      - edns_extensions: |
          EDNS(0) extensions:
          - UDP packet size increase
          - DNSSEC OK (DO) flag
          - Client subnet (ECS)
          - Cookie support
          Security:
          - Cookie validation
          - ECS privacy implications

  # DNS Attack Vectors (30 topics)
  dns_attacks:
    cache_poisoning:
      - kaminsky_attack: |
          Dan Kaminsky cache poisoning:
          - Flood authoritative queries
          - Race condition in response
          - Guess transaction ID (16-bit)
          - Birthday attack on IDs
          Mitigations:
          - Source port randomization
          - 0x20 encoding (mixed case)
          - DNSSEC validation
      
      - birthday_attack: |
          Birthday paradox in DNS:
          - Multiple simultaneous queries
          - Increased collision probability
          - Transaction ID prediction
          Mitigation:
          - Query name randomization
          - Source port randomization
          - DNSSEC
      
      - sad_dns: |
          Side-channel AttackeD DNS (2020):
          - ICMP rate limiting side channel
          - Port scan via ICMP
          - Off-path cache poisoning
          - Affects major resolvers
          Mitigation:
          - Disable ICMP rate limiting info
          - DNSSEC validation
          - DNS-over-HTTPS/TLS
      
      - ghost_domain: |
          Ghost domain attack:
          - Exploit caching after delegation change
          - Maintain cached poisoned data
          - Bypass TTL refresh
    
    hijacking:
      - registrar_hijacking: |
          Registrar account compromise:
          - Credential theft
          - Social engineering
          - Insider threat
          - API token theft
          Notable incidents:
          - Lenovo (2015)
          - NY Times (2013)
          - Various crypto domains
          Protection:
          - Registry lock
          - MFA on registrar
          - WHOIS monitoring
      
      - dns_server_compromise: |
          Authoritative server takeover:
          - Server vulnerability exploitation
          - Credential compromise
          - Configuration manipulation
          Detection:
          - Monitor zone changes
          - Alert on NS changes
          - Certificate transparency
      
      - bgp_dns_hijacking: |
          BGP-based DNS hijacking:
          - Announce DNS server IP prefixes
          - Redirect resolver traffic
          - Route53 hijacking (2018)
          MyEtherWallet incident
          Protection:
          - RPKI/ROA validation
          - BGP monitoring
          - Multiple anycast locations
      
      - rogue_dhcp_dns: |
          DHCP-based DNS hijacking:
          - Rogue DHCP server
          - Malicious DNS server assignment
          - Man-in-the-middle position
          Protection:
          - DHCP snooping
          - Static DNS configuration
          - 802.1X authentication
    
    subdomain_attacks:
      - subdomain_takeover: |
          Dangling DNS takeover:
          - CNAME to unclaimed resource
          - A record to unused IP
          - NS delegation to uncontrolled NS
          Vulnerable services:
          - AWS S3/CloudFront/Elastic Beanstalk
          - Azure Websites/Traffic Manager
          - GitHub Pages
          - Heroku
          - Pantheon
          - Shopify
          Detection:
          - NX domain checks
          - HTTP response validation
          - Service fingerprinting
      
      - ns_takeover: |
          NS delegation takeover:
          - NS points to expired domain
          - Register expired NS domain
          - Full zone control
          Impact:
          - Issue certificates
          - Receive email
          - Host malicious content
      
      - wildcard_abuse: |
          Wildcard record exploitation:
          - *.domain.com catches all
          - Shadow subdomains
          - Phishing infrastructure
    
    amplification:
      - dns_reflection: |
          DNS reflection/amplification DDoS:
          - Small query, large response
          - Amplification factor 50-70x
          - Open resolvers exploited
          - ANY query abuse
          Mitigation:
          - Rate limiting
          - Response Rate Limiting (RRL)
          - Block ANY from external
          - BCP38 source validation
      
      - nxdomain_attack: |
          NXDOMAIN flood:
          - Query non-existent domains
          - Exhaust cache resources
          - Force authoritative queries
          - Slow recursive resolution
          Mitigation:
          - Aggressive NSEC caching
          - Query rate limiting
          - NXDOMAIN rate limiting
    
    rebinding:
      - dns_rebinding: |
          DNS rebinding attack:
          - Attacker controls DNS
          - First response: attacker IP
          - JavaScript loads
          - TTL expires, second query
          - Second response: internal IP
          - JS now accesses internal network
          Attack targets:
          - Internal web apps
          - IoT devices
          - Cloud metadata (169.254.169.254)
          Protection:
          - Validate Host header
          - DNS pinning
          - Private IP filtering in resolvers
          - Same-origin restrictions
      
      - toctou_rebinding: |
          Time-of-check-to-time-of-use:
          - DNS lookup at check
          - Different IP at use
          - Race condition window
    
    tunneling:
      - dns_tunneling: |
          DNS as covert channel:
          - Encode data in queries
          - Exfiltrate via TXT responses
          - C2 communication
          - Bypass firewalls
          Detection:
          - Query length analysis
          - Entropy detection
          - TXT record monitoring
          - Query frequency analysis
          Tools:
          - iodine
          - dnscat2
          - dns2tcp
      
      - dns_exfiltration: |
          Data exfiltration via DNS:
          - Encode in subdomain labels
          - base32/base64 encoding
          - Slow and stealthy
          Detection:
          - Label length analysis
          - Unique subdomain count
          - Response size anomalies

  # DNSSEC (20 topics)
  dnssec:
    fundamentals:
      - dnssec_chain_of_trust: |
          DNSSEC trust hierarchy:
          - Root zone signed (ICANN)
          - TLD signed by root
          - Domain signed by TLD
          - DS records link zones
          Validation:
          - DNSKEY at each level
          - RRSIG for each RRset
          - DS in parent zone
      
      - key_types: |
          DNSSEC key management:
          - KSK (Key Signing Key): signs DNSKEY
          - ZSK (Zone Signing Key): signs records
          - Key rollover procedures
          - Key sizes (RSA 2048+, ECDSA P-256)
          Algorithms:
          - RSASHA256 (8)
          - RSASHA512 (10)
          - ECDSAP256SHA256 (13)
          - ECDSAP384SHA384 (14)
          - ED25519 (15)
          - ED448 (16)
      
      - nsec_nsec3: |
          Authenticated denial of existence:
          - NSEC: lists next name (zone walking)
          - NSEC3: hashed names
          - NSEC3 opt-out for large zones
          - NSEC3 salt and iterations
          Privacy:
          - NSEC allows enumeration
          - NSEC3 prevents enumeration
          - Trade-off with complexity
    
    implementation:
      - zone_signing: |
          Zone signing process:
          1. Generate KSK and ZSK
          2. Sign zone with ZSK
          3. Sign DNSKEY RRset with KSK
          4. Publish DS in parent
          5. Monitor and rotate
          Tools:
          - BIND dnssec-keygen, dnssec-signzone
          - PowerDNS pdnsutil
          - Knot dnssec-keymgr
      
      - key_rollover: |
          DNSSEC key rollover:
          - ZSK rollover (monthly)
          - KSK rollover (yearly)
          - Pre-publish method
          - Double signature method
          - RFC 7583 timing
          Risks:
          - Validation failure during rollover
          - TTL consideration
          - DS record timing
      
      - algorithm_rollover: |
          Algorithm upgrade:
          - Deprecated algorithms
          - Dual-signing period
          - Validator support
          - Coordination with registrar
    
    validation:
      - resolver_validation: |
          DNSSEC validation in resolvers:
          - Trust anchor configuration
          - Root key management
          - RFC 5011 automatic updates
          - Validation failure handling
          Configuration:
          - BIND: dnssec-validation auto;
          - Unbound: auto-trust-anchor-file
      
      - validation_failures: |
          Handling DNSSEC failures:
          - SERVFAIL on validation failure
          - Negative trust anchors
          - Debugging tools (delv, dig +dnssec)
          - Common misconfigurations
    
    issues:
      - dnssec_dos: |
          DNSSEC amplification:
          - Large responses with signatures
          - Key-tag rollover attacks
          - Replay of signed responses
      
      - key_compromise: |
          DNSSEC key compromise:
          - Emergency key rollover
          - Parent notification
          - Revocation procedures
          - RFC 5011 revoke bit

  # DNS Infrastructure (15 topics)
  dns_infrastructure:
    authoritative:
      - primary_secondary: |
          DNS server architecture:
          - Primary (master) server
          - Secondary (slave) servers
          - Zone transfers (AXFR/IXFR)
          - Hidden primary pattern
          Security:
          - Restrict zone transfers
          - TSIG authentication
          - Hidden primary behind firewall
      
      - anycast_dns: |
          Anycast deployment:
          - Same IP, multiple locations
          - BGP routing to nearest
          - DDoS resilience
          - Latency reduction
          Considerations:
          - Catchment areas
          - Failover behavior
          - Monitoring complexity
      
      - managed_dns: |
          Managed DNS services:
          - AWS Route 53
          - Google Cloud DNS
          - Azure DNS
          - Cloudflare DNS
          - NS1
          Security:
          - IAM for changes
          - Audit logging
          - DNSSEC support
    
    resolvers:
      - recursive_resolvers: |
          Recursive resolver deployment:
          - Internal resolver vs ISP
          - Public resolvers (8.8.8.8, 1.1.1.1)
          - DNSSEC validation
          - Cache configuration
          Security:
          - Access restrictions
          - Query logging
          - Forwarder security
      
      - dns_over_encryption: |
          Encrypted DNS protocols:
          - DNS over HTTPS (DoH) - RFC 8484
          - DNS over TLS (DoT) - RFC 7858
          - DNS over QUIC (DoQ) - RFC 9250
          - DNSCrypt
          Benefits:
          - Privacy from eavesdropping
          - Integrity protection
          - Bypass censorship
          Considerations:
          - Enterprise visibility
          - Performance
          - Resolver trust
      
      - split_horizon: |
          Split-brain DNS:
          - Different responses internal/external
          - View configuration
          - ACL-based responses
          Security:
          - Internal zone protection
          - Consistent external view
          - Avoid information leakage

  # Cloud DNS Security (15 topics)
  cloud_dns:
    aws:
      - route53_security: |
          AWS Route 53 security:
          - IAM policies for DNS changes
          - CloudTrail logging
          - Route 53 Resolver DNS Firewall
          - DNSSEC signing
          - Private hosted zones
          - Resolver endpoints (inbound/outbound)
          
          Best practices:
          - Separate IAM for DNS admin
          - Alert on zone changes
          - Use alias records for AWS resources
          - Enable query logging
      
      - route53_resolver_firewall: |
          DNS Firewall rules:
          - Block malicious domains
          - Managed domain lists
          - Custom block lists
          - Allow list exceptions
          - Rule group priority
    
    gcp:
      - cloud_dns_security: |
          GCP Cloud DNS:
          - IAM for DNS management
          - Audit logging
          - DNSSEC support
          - Private zones
          - DNS peering
          - Forwarding zones
          - Response policies
      
      - cloud_dns_policies: |
          Response policies:
          - Block/redirect resolution
          - Local data injection
          - Bypass rules
    
    azure:
      - azure_dns_security: |
          Azure DNS:
          - RBAC for management
          - Activity log monitoring
          - Private DNS zones
          - Virtual network links
          - DNS zone delegation
          - DNSSEC (preview)
      
      - azure_private_dns: |
          Private DNS zones:
          - VNet integration
          - Auto-registration
          - Split-horizon scenarios

# === FAILURE SCENARIOS ===
# 50+ detailed failure scenarios
failure_scenarios:
  high_profile_incidents:
    - scenario: "MyEtherWallet BGP/DNS Hijacking (2018)"
      description: |
        1. Attackers hijacked Amazon Route 53 IP prefix
        2. BGP announcement from unauthorized AS
        3. DNS queries redirected to attacker server
        4. Phishing site served for MEW
        5. $150,000+ in crypto stolen
      lessons:
        - "RPKI/ROA validation"
        - "DNSSEC prevents response manipulation"
        - "Monitor BGP announcements"
        - "Certificate pinning in apps"
    
    - scenario: "Sea Turtle DNS Hijacking Campaign (2019)"
      description: |
        1. State-sponsored actors
        2. Compromised registrar accounts
        3. Modified NS records
        4. Man-in-the-middle SSL certificates
        5. 40+ organizations in 13 countries
      lessons:
        - "Registry lock for critical domains"
        - "MFA everywhere"
        - "Certificate transparency monitoring"
        - "DNSSEC deployment"
    
    - scenario: "DNSpionage Campaign (2018-2019)"
      description: |
        1. Targeted Middle East organizations
        2. DNS record modification
        3. Intercepted credentials
        4. Long-term persistence
      lessons:
        - "DNS change monitoring"
        - "Out-of-band verification"
        - "Incident response planning"
    
    - scenario: "Dyn DDoS Attack (2016)"
      description: |
        1. Mirai botnet (IoT devices)
        2. Massive DNS amplification
        3. Major sites unreachable
        4. Twitter, Netflix, GitHub, etc.
      lessons:
        - "Anycast distribution"
        - "Multiple DNS providers"
        - "Rate limiting"
        - "IoT security"
  
  common_attack_scenarios:
    - scenario: "Subdomain takeover via CloudFront"
      description: |
        1. CNAME: cdn.victim.com → d123.cloudfront.net
        2. CloudFront distribution deleted
        3. Attacker creates new distribution
        4. Claims d123.cloudfront.net CNAME
        5. Serves malicious content on cdn.victim.com
      detection:
        - "DNS record audit"
        - "HTTP response monitoring"
        - "Service inventory management"
      prevention:
        - "Delete DNS before decommissioning"
        - "Automated subdomain monitoring"
        - "Ownership verification"
    
    - scenario: "DNS rebinding attacks internal services"
      description: |
        1. Employee visits attacker site
        2. Site resolves to attacker IP
        3. JavaScript loads
        4. DNS rebinds to 192.168.1.1 (router)
        5. JS accesses router admin panel
        6. Router reconfigured/compromised
      prevention:
        - "DNS rebinding protection in resolver"
        - "Host header validation"
        - "Authentication on internal services"
    
    - scenario: "Zone transfer exposes internal infrastructure"
      description: |
        1. AXFR allowed from any IP
        2. Attacker queries zone transfer
        3. Receives complete zone file
        4. Internal hostnames revealed
        5. Attack surface mapped
      command: |
        dig @ns1.victim.com victim.com AXFR
      prevention:
        - "Restrict AXFR to secondary servers"
        - "TSIG authentication"
        - "Separate internal/external zones"
    
    - scenario: "DNSSEC validation failure causes outage"
      description: |
        1. DNSSEC key expires
        2. Signatures become invalid
        3. Validating resolvers return SERVFAIL
        4. All queries fail for domain
        5. Complete service outage
      prevention:
        - "Key expiration monitoring"
        - "Automated key rotation"
        - "Validation testing"
  
  compliance_failures:
    - scenario: "DNSSEC not deployed per regulation"
      description: |
        1. Industry regulation requires DNSSEC
        2. Domain lacks DNSSEC
        3. Audit finding issued
        4. Remediation required
      regulations:
        - "FedRAMP requires DNSSEC for .gov"
        - "Financial sector requirements"
        - "Healthcare data protection"

# === CLOUD-SPECIFIC ISSUES ===
# 100+ cloud-specific DNS security issues
cloud_specific_issues:
  aws:
    route53:
      - hosted_zone_security: |
          Route 53 hosted zone security:
          - IAM policy for zone management
          - Resource-based policies
          - VPC association for private zones
          - Query logging to CloudWatch
          
          Sample IAM policy:
          {
            "Effect": "Allow",
            "Action": [
              "route53:GetHostedZone",
              "route53:ListResourceRecordSets"
            ],
            "Resource": "arn:aws:route53:::hostedzone/Z123456"
          }
      
      - dnssec_route53: |
          Route 53 DNSSEC signing:
          - Enable DNSSEC signing on hosted zone
          - KMS key for DNSSEC
          - DS record to registrar
          - Key rotation (KMS managed)
          
          Limitations:
          - Only for public hosted zones
          - Additional KMS costs
      
      - health_checks: |
          Route 53 health check security:
          - Health check IPs (allow in firewall)
          - SNI support
          - HTTPS verification
          - Latency-based routing
          - Failover routing
      
      - resolver_endpoints: |
          Route 53 Resolver:
          - Inbound endpoints (on-prem to VPC)
          - Outbound endpoints (VPC to on-prem)
          - Resolver rules
          - Security groups
          - VPC DNS attributes
    
    firewall:
      - dns_firewall_rules: |
          Route 53 Resolver DNS Firewall:
          - Domain lists (AWS managed + custom)
          - Rule groups
          - Firewall rule actions (ALLOW/BLOCK/ALERT)
          - Association to VPCs
          
          Managed domain lists:
          - AWSManagedDomainsMalwareDomainList
          - AWSManagedDomainsBotnetCommandandControl
          - AWS Managed Domains NewlyObservedDomains
  
  gcp:
    cloud_dns:
      - dns_security_policies: |
          Cloud DNS security:
          - IAM roles (dns.admin, dns.peer)
          - Audit logging
          - DNSSEC management
          - Private zones
          
          Best practices:
          - Separate project for DNS
          - Enable VPC flow logs
          - Use Cloud Armor for protection
      
      - response_policies: |
          Cloud DNS response policies:
          - Block malicious domains
          - Override resolution
          - Internal domain redirects
          - Sink routing
      
      - dns_peering: |
          DNS peering:
          - Cross-project resolution
          - On-premises integration
          - Transitive peering limitations
  
  azure:
    dns:
      - private_dns_zones: |
          Azure Private DNS:
          - VNet links
          - Auto-registration
          - Record types supported
          - Limits and quotas
          
          Security:
          - RBAC for management
          - Private endpoints
          - Service endpoints
      
      - dns_resolver: |
          Azure DNS Private Resolver:
          - Inbound/outbound endpoints
          - DNS forwarding rulesets
          - Conditional forwarding
          - VNet integration
      
      - traffic_manager: |
          Traffic Manager DNS:
          - Geographic routing
          - Health probes
          - Nested profiles
          - CNAME flattening

# === DIFFICULTY MULTIPLIERS ===
difficulty_multipliers:
  zone_count:
    description: "Number of DNS zones"
    complexity_factor:
      - "1-5 zones: 1.0x"
      - "5-20 zones: 1.5x"
      - "20-100 zones: 2.0x"
      - "> 100 zones: 3.0x"
  
  dnssec_deployment:
    description: "DNSSEC implementation complexity"
    complexity_factor:
      - "No DNSSEC: 1.0x"
      - "DNSSEC signing only: 1.5x"
      - "DNSSEC with validation: 2.0x"
      - "Full DNSSEC with key rotation automation: 2.5x"
  
  hybrid_environment:
    description: "On-premises and cloud DNS integration"
    complexity_factor: 2.0
    challenges:
      - "Split-horizon configuration"
      - "Forwarding rules"
      - "Trust boundaries"
      - "Latency considerations"
  
  multi_cloud:
    description: "DNS across multiple cloud providers"
    complexity_factor: 2.5
    challenges:
      - "Consistent policy"
      - "Cross-cloud failover"
      - "Unified monitoring"
  
  compliance:
    fedramp:
      complexity_factor: 2.0
      requirements:
        - "DNSSEC for .gov domains"
        - "Logging and monitoring"
        - "Change management"
    
    financial:
      complexity_factor: 1.8
      requirements:
        - "High availability"
        - "Audit trails"
        - "Incident response"
  
  availability_targets:
    - "99.9%: Standard configuration"
    - "99.99%: Multi-provider, anycast"
    - "99.999%: Global anycast, automated failover"

# === terminal-bench style fields ===
difficulty:
  estimated: "hard"
  time_range: [1800, 14400]
  command_steps: [40, 200]

# === Difficulty amplifiers ===
difficulty_amplifiers:
  nightmare:
    multiplier: 3.0
    description: "Production-level incident requiring multi-team coordination knowledge"
    requirements:
      - "7+ interacting failures across CI/CD, containers, and infrastructure"
      - "Requires understanding of cloud provider-specific behaviors"
      - "Time estimate: 120+ minutes for senior SREs"
      - "Cross-service dependencies that cascade in non-obvious ways"
      - "Requires synthesizing security, performance, and reliability knowledge"

# === Quality requirements ===
quality_requirements:
  minimum_difficulty: "90-240 minutes, requires senior SRE/DevSecOps engineers with cloud architecture and DNS security expertise"
  time_estimate: "90-240 minutes for senior SRE/DevSecOps engineers, 4-8 hours for intermediate"
  trap_count: "10+ deeply interacting traps across CI/CD, container, cloud, and monitoring boundaries"

# === Multi-Agent Orchestration Complexity ===
multi_agent_orchestration:
  description: "Coordinating 5-8 specialized DevOps agents for comprehensive DNS security and attack prevention"
  required_agents:
    - dns_protocol_expert:
        role: "Deep analysis of DNS protocol vulnerabilities and attack vectors"
        expertise: ["cache poisoning", "DNSSEC", "zone transfers", "DNS amplification"]
    - network_security_analyst:
        role: "Analyzing network-level DNS attacks and defenses"
        expertise: ["BGP hijacking", "DNS rebinding", "network segmentation", "firewall rules"]
    - cloud_dns_specialist:
        role: "Managing cloud-native DNS services and their security configurations"
        expertise: ["Route 53", "Cloud DNS", "Azure DNS", "DNS firewalls"]
    - registrar_security_expert:
        role: "Securing domain registrar accounts and preventing hijacking"
        expertise: ["registry lock", "MFA", "WHOIS protection", "transfer monitoring"]
    - certificate_authority_analyst:
        role: "Managing CAA records and certificate transparency"
        expertise: ["CAA configuration", "CT log monitoring", "certificate issuance controls"]
    - incident_responder:
        role: "Managing DNS-related security incidents and domain hijacking"
        expertise: ["containment", "domain recovery", "forensics", "stakeholder communication"]
    - compliance_auditor:
        role: "Ensuring DNS configurations meet regulatory requirements"
        expertise: ["DNSSEC requirements", "audit logging", "change management"]
    - threat_intelligence_analyst:
        role: "Monitoring for DNS-based threats and attack campaigns"
        expertise: ["threat feeds", "subdomain takeover detection", "brand protection"]
  
  cross_platform_attack_chains:
    - name: "Registrar Compromise to Full Infrastructure Control"
      stages:
        - "Attacker compromises registrar account via credential stuffing"
        - "NS records changed to attacker-controlled nameservers"
        - "Attacker responds to all DNS queries for victim domain"
        - "SSL certificates issued using DNS-01 challenges"
        - "Man-in-the-middle attacks on all domain traffic"
        - "Credential harvesting from phishing site on victim domain"
        - "Lateral movement using harvested credentials"
        - "Persistent access via additional backdoor subdomains"
    - name: "Subdomain Takeover to Cloud Account Compromise"
      stages:
        - "Attacker identifies dangling CNAME to CloudFront"
        - "Claims orphaned CloudFront distribution"
        - "Serves malicious content on victim subdomain"
        - "Phishes internal employees using trusted subdomain"
        - "Steals cloud console credentials"
        - "Escalates to full cloud account access"
  
  parallel_analysis_requirements:
    - "Simultaneous scanning of all domain records for vulnerabilities"
    - "Correlated analysis of DNS queries, BGP routes, and certificate issuance"
    - "Real-time monitoring of DNSSEC validation and key status"
    - "Cross-reference of subdomain records with active service inventory"
  
  agent_handoff_scenarios:
    - "Protocol expert identifies DNSSEC misconfiguration → Cloud specialist validates cloud DNS settings → Compliance auditor verifies regulatory requirements"
    - "Threat analyst detects subdomain takeover risk → Network analyst verifies service connectivity → Incident responder initiates record cleanup"
    - "Registrar expert identifies weak security → Certificate analyst checks CAA coverage → Compliance auditor documents remediation"

# === Nightmare Plus Difficulty Level ===
difficulty_levels:
  nightmare_plus:
    estimated_time: [28800, 172800]  # 8-48 hours
    command_steps: [400, 1500]
    techniques_required: 12
    description: "DNS security crisis requiring deep protocol knowledge and multi-provider coordination"
    characteristics:
      - "Multi-provider DNS configuration across AWS, GCP, Azure"
      - "DNSSEC key rollover during active attack"
      - "Cross-border domain jurisdiction complications"
      - "BGP hijacking affecting DNS resolution"
      - "Mass subdomain takeover across hundreds of records"
      - "Certificate transparency log monitoring at scale"
      - "DNS rebinding attacks targeting internal services"
      - "Coordinated attack combining DNS and BGP manipulation"
    required_expertise:
      - "Deep understanding of DNS protocol and resolution process"
      - "Knowledge of DNSSEC cryptography and key management"
      - "Experience with multi-cloud DNS architectures"
      - "Familiarity with BGP routing and RPKI"
      - "Understanding of certificate issuance and CAA enforcement"

# === Cloud Native Internals ===
cloud_native_internals:
  kubernetes_internals:
    kubelet:
      - "DNS policy configuration and resolution behavior"
      - "ndots and search domain performance implications"
      - "CoreDNS pod anti-affinity requirements"
    controller_manager:
      - "Service discovery DNS record management"
      - "Headless service DNS behavior"
      - "ExternalName service DNS security"
    scheduler:
      - "CoreDNS pod scheduling for high availability"
      - "DNS service topology awareness"
    coredns:
      - "Plugin chain configuration and security"
      - "Cache poisoning prevention"
      - "Forward plugin security"
      - "Kubernetes plugin zone configuration"
      - "Loop detection and prevention"
  
  container_runtime_internals:
    containerd:
      - "DNS configuration injection into containers"
      - "resolv.conf management"
    cri_o:
      - "DNS settings in container runtime"
  
  service_mesh_internals:
    envoy:
      - "DNS-based service discovery security"
      - "Strict DNS vs logical DNS"
      - "DNS cache configuration"
    istio_data_plane:
      - "ServiceEntry DNS resolution"
      - "Sidecar DNS proxying"
      - "External service DNS configuration"
  
  cloud_provider_iam_quirks:
    aws:
      - "Route 53 IAM permissions and resource policies"
      - "Route 53 Resolver DNS Firewall configuration"
      - "VPC DNS attributes and DHCP options"
      - "Cross-account Route 53 access"
      - "Route 53 DNSSEC signing with KMS"
    gcp:
      - "Cloud DNS IAM bindings"
      - "DNS peering and forwarding zones"
      - "Response policies for DNS firewall"
      - "DNSSEC key management"
    azure:
      - "Azure DNS RBAC configuration"
      - "Private DNS zone VNet links"
      - "Azure DNS Private Resolver"
      - "Traffic Manager DNS-based routing"

# === Supply Chain Attack Vectors ===
supply_chain_attack_vectors:
  dependency_confusion_variants:
    - dns_based_package_resolution: "Packages with DNS-based dependency resolution"
    - internal_dns_name_squatting: "Registering internal service names externally"
    - dns_rebinding_packages: "Packages that exploit DNS rebinding"
  
  build_process_manipulation:
    - ci_dns_poisoning: "Poisoning CI/CD environment DNS resolution"
    - build_time_dns_hijacking: "Hijacking DNS during dependency downloads"
    - artifact_dns_manipulation: "Changing artifact URLs via DNS manipulation"
  
  registry_poisoning:
    - registry_dns_hijacking: "Hijacking DNS for package registries"
    - mirror_dns_redirection: "Redirecting mirror DNS to malicious sources"
  
  artifact_signing_bypass:
    - crl_dns_manipulation: "Manipulating CRL/OCSP DNS for certificate validation"
    - timestamp_server_hijacking: "Hijacking timestamp server DNS"

# === Incident Response Complexity ===
incident_response_complexity:
  production_debugging_scenarios:
    - scenario: "Domain hijacked via registrar compromise"
      complexity_factors:
        - "Contact registrar for emergency recovery"
        - "Prove domain ownership without DNS control"
        - "Coordinate with certificate authorities for revocation"
        - "Assess scope of credential compromise via MitM"
        - "Notify customers of potential data exposure"
        - "Implement registry lock after recovery"
      required_coordination:
        - "Legal team for domain recovery"
        - "Security team for compromise assessment"
        - "Communications team for customer notification"
        - "Registrar support for emergency procedures"
        - "Certificate authorities for revocation"
    
    - scenario: "DNSSEC key compromise requiring emergency rollover"
      complexity_factors:
        - "Coordinate key rollover without resolution failure"
        - "Update DS records at registrar"
        - "Monitor validation status across resolver population"
        - "Handle cached invalid signatures during transition"
        - "Communicate with downstream services about resolution issues"
      forensic_requirements:
        - "DNSSEC validation log analysis"
        - "Key access audit trail review"
        - "DNS query pattern analysis for exploitation"
        - "BGP route history analysis"
    
    - scenario: "Mass subdomain takeover campaign targeting organization"
      complexity_factors:
        - "Identify all vulnerable subdomain records"
        - "Prioritize remediation by business impact"
        - "Coordinate with cloud providers for resource verification"
        - "Implement automated monitoring to prevent recurrence"
        - "Assess if any takeovers were maliciously exploited"

# === LLM trap configurations ===
traps:
  - type: "no_dnssec"
    description: "DNS responses can be spoofed"
    trigger: "Not enabling DNSSEC validation"
    severity: "high"
  
  - type: "registrar_weak"
    description: "Domain stolen via registrar compromise"
    trigger: "No registrar lock or weak auth"
    severity: "critical"
  
  - type: "subdomain_dangling"
    description: "CNAME points to unclaimed resource"
    trigger: "Not auditing subdomain records"
    severity: "high"
  
  - type: "zone_transfer_open"
    description: "AXFR allowed to any IP"
    trigger: "Zone transfer not restricted"
    severity: "high"
  
  - type: "no_caa"
    description: "No CAA records restrict certificate issuance"
    trigger: "Missing CAA records"
    severity: "medium"
  
  - type: "rebinding_vulnerable"
    description: "Internal services accessible via rebinding"
    trigger: "No Host header validation"
    severity: "high"
  
  - type: "amplification_possible"
    description: "DNS server can be used for DDoS"
    trigger: "No rate limiting or RRL"
    severity: "medium"
  
  - type: "key_expiration"
    description: "DNSSEC keys will expire"
    trigger: "No key rotation monitoring"
    severity: "high"

# === Task generation template ===
instruction_template: |
  You are securing DNS infrastructure for a {{ scenario_type }} organization.
  The configuration is at {{ path }}.
  
  Environment Details:
  - DNS Provider: {{ dns_provider }}
  - Zones: {{ zone_count }} zones
  - Records: {{ record_count }} total records
  - Current DNSSEC status: {{ dnssec_status }}
  - Domains: {{ domain_count }} registered domains
  
  Current Issues:
  - Dangling subdomains: {{ dangling_count }}
  - Open zone transfers: {{ open_transfers }}
  - Missing CAA records: {{ missing_caa }}
  - DNSSEC validation failures: {{ validation_failures }}
  
  Compliance Requirements: {{ compliance_frameworks }}
  Availability Target: {{ availability_target }}
  
  Your task:
  {{ task_steps }}
  
  Deliverables:
  - Secure DNS configuration
  - DNSSEC deployment plan
  - Subdomain audit results
  - Monitoring setup
  - Incident response procedures

# === Reference solution (hidden from agent) ===
reference_solution: |
  # DNS Security Hardening - Comprehensive Guide
  
  # ============================================================
  # PHASE 1: DNSSEC IMPLEMENTATION
  # ============================================================
  
  ## 1.1 BIND DNSSEC Configuration
  
  # Generate keys
  cd /etc/bind/keys
  
  # Key Signing Key (KSK)
  dnssec-keygen -a ECDSAP256SHA256 -f KSK -n ZONE example.com
  
  # Zone Signing Key (ZSK)
  dnssec-keygen -a ECDSAP256SHA256 -n ZONE example.com
  
  # Sign the zone
  dnssec-signzone -A -3 $(head -c 16 /dev/urandom | od -An -tx1 | tr -d ' ') \
    -N INCREMENT -o example.com -t db.example.com
  
  # named.conf.local
  zone "example.com" {
      type master;
      file "/etc/bind/zones/db.example.com.signed";
      key-directory "/etc/bind/keys";
      auto-dnssec maintain;
      inline-signing yes;
      dnssec-dnskey-kskonly no;
  };
  
  # Enable DNSSEC validation
  # named.conf.options
  options {
      dnssec-validation auto;
      dnssec-accept-expired no;
  };
  
  ## 1.2 Submit DS Record to Registrar
  
  # Get DS record from DNSKEY
  dnssec-dsfromkey -2 Kexample.com.+013+12345.key
  
  # Output format for registrar:
  # example.com. IN DS 12345 13 2 ABC123...
  
  ## 1.3 AWS Route 53 DNSSEC
  
  # Enable DNSSEC signing
  aws route53 enable-hosted-zone-dnssec \
    --hosted-zone-id Z123456789 \
    --signing-key-signing-key KeyManagementServiceArn=arn:aws:kms:us-east-1:123456789:key/abc123
  
  # Get DS record for registrar
  aws route53 get-dnssec \
    --hosted-zone-id Z123456789
  
  # ============================================================
  # PHASE 2: ZONE TRANSFER RESTRICTION
  # ============================================================
  
  ## 2.1 BIND Zone Transfer ACL
  
  # named.conf.options
  acl "trusted-secondaries" {
      192.0.2.1;      # ns2.example.com
      192.0.2.2;      # ns3.example.com
      2001:db8::1;    # ns2 IPv6
  };
  
  options {
      allow-transfer { "trusted-secondaries"; };
      allow-notify { "trusted-secondaries"; };
  };
  
  ## 2.2 TSIG Authentication
  
  # Generate TSIG key
  tsig-keygen -a hmac-sha256 transfer-key > /etc/bind/transfer-key.conf
  
  # Include in named.conf
  include "/etc/bind/transfer-key.conf";
  
  # Zone configuration with TSIG
  zone "example.com" {
      type master;
      file "/etc/bind/zones/db.example.com";
      allow-transfer { key "transfer-key"; };
      also-notify { 192.0.2.1 key "transfer-key"; };
  };
  
  # Secondary server configuration
  server 192.0.2.1 {
      keys { "transfer-key"; };
  };
  
  # ============================================================
  # PHASE 3: DNS REBINDING PROTECTION
  # ============================================================
  
  ## 3.1 Resolver Configuration (BIND)
  
  # named.conf.options
  options {
      # Block private IP ranges in responses
      deny-answer-addresses {
          10.0.0.0/8;
          172.16.0.0/12;
          192.168.0.0/16;
          127.0.0.0/8;
          169.254.0.0/16;
          fc00::/7;
          fe80::/10;
          ::1/128;
      } except-from {
          "internal.example.com";
      };
      
      deny-answer-aliases {
          "localhost";
      } except-from {
          "internal.example.com";
      };
  };
  
  ## 3.2 Application Level Protection
  
  # Python Flask example
  from flask import Flask, request, abort
  
  app = Flask(__name__)
  
  ALLOWED_HOSTS = {
      'example.com',
      'www.example.com',
      'api.example.com',
  }
  
  @app.before_request
  def validate_host():
      host = request.host.split(':')[0].lower()
      if host not in ALLOWED_HOSTS:
          abort(400, description="Invalid Host header")
  
  ## 3.3 Nginx Host Header Validation
  
  # nginx.conf
  server {
      listen 80 default_server;
      server_name _;
      return 444;  # Drop connection for unknown hosts
  }
  
  server {
      listen 80;
      server_name example.com www.example.com;
      
      # Additional validation
      if ($host !~ ^(example\.com|www\.example\.com)$) {
          return 444;
      }
  }
  
  # ============================================================
  # PHASE 4: SUBDOMAIN TAKEOVER PREVENTION
  # ============================================================
  
  ## 4.1 Audit Script
  
  #!/bin/bash
  # subdomain-audit.sh
  
  DOMAIN="example.com"
  ZONE_FILE="/etc/bind/zones/db.$DOMAIN"
  
  # Extract CNAME records
  grep "CNAME" $ZONE_FILE | while read line; do
      subdomain=$(echo $line | awk '{print $1}')
      target=$(echo $line | awk '{print $NF}' | sed 's/\.$//')
      
      # Check if target resolves
      if ! host $target &>/dev/null; then
          echo "ALERT: Dangling CNAME - $subdomain -> $target"
      fi
      
      # Check for vulnerable services
      case $target in
          *.cloudfront.net)
              # Check CloudFront distribution exists
              curl -sI "https://$target" | grep -q "403\|200" || \
                  echo "VULNERABLE: CloudFront - $subdomain -> $target"
              ;;
          *.s3.amazonaws.com|*.s3-website-*.amazonaws.com)
              curl -sI "http://$target" | grep -q "NoSuchBucket" && \
                  echo "VULNERABLE: S3 - $subdomain -> $target"
              ;;
          *.azurewebsites.net)
              curl -sI "https://$target" | grep -q "404" && \
                  echo "VULNERABLE: Azure - $subdomain -> $target"
              ;;
          *.herokuapp.com)
              curl -sI "https://$target" | grep -q "No such app" && \
                  echo "VULNERABLE: Heroku - $subdomain -> $target"
              ;;
          *.github.io)
              curl -sI "https://$target" | grep -q "404" && \
                  echo "VULNERABLE: GitHub - $subdomain -> $target"
              ;;
      esac
  done
  
  ## 4.2 Automated Monitoring
  
  # GitHub Action for subdomain monitoring
  name: Subdomain Audit
  
  on:
    schedule:
      - cron: '0 6 * * *'  # Daily at 6 AM
  
  jobs:
    audit:
      runs-on: ubuntu-latest
      steps:
        - name: Install tools
          run: |
            pip install dnspython requests
        
        - name: Run audit
          run: |
            python audit_subdomains.py
          env:
            DOMAIN: example.com
            SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
  
  # ============================================================
  # PHASE 5: CAA RECORDS
  # ============================================================
  
  ## 5.1 CAA Record Configuration
  
  # Zone file entries
  ; Only allow Let's Encrypt and DigiCert to issue certificates
  @       IN      CAA     0 issue "letsencrypt.org"
  @       IN      CAA     0 issue "digicert.com"
  @       IN      CAA     0 issuewild "letsencrypt.org"
  @       IN      CAA     0 iodef "mailto:security@example.com"
  
  ; For subdomains with different requirements
  api     IN      CAA     0 issue "digicert.com"
  
  ## 5.2 Route 53 CAA
  
  aws route53 change-resource-record-sets \
    --hosted-zone-id Z123456789 \
    --change-batch '{
      "Changes": [{
        "Action": "UPSERT",
        "ResourceRecordSet": {
          "Name": "example.com",
          "Type": "CAA",
          "TTL": 3600,
          "ResourceRecords": [
            {"Value": "0 issue \"letsencrypt.org\""},
            {"Value": "0 issuewild \"letsencrypt.org\""},
            {"Value": "0 iodef \"mailto:security@example.com\""}
          ]
        }
      }]
    }'
  
  # ============================================================
  # PHASE 6: MONITORING AND ALERTING
  # ============================================================
  
  ## 6.1 DNS Query Logging (Route 53)
  
  # Enable query logging
  aws route53resolver create-resolver-query-log-config \
    --name "dns-query-logs" \
    --destination-arn "arn:aws:logs:us-east-1:123456789:log-group:/dns/query-logs"
  
  ## 6.2 CloudWatch Alarms
  
  # Alarm for DNSSEC validation failures
  aws cloudwatch put-metric-alarm \
    --alarm-name "DNSSECValidationFailures" \
    --metric-name "DNSSECValidationFailed" \
    --namespace "AWS/Route53Resolver" \
    --statistic Sum \
    --period 300 \
    --evaluation-periods 1 \
    --threshold 10 \
    --comparison-operator GreaterThanThreshold \
    --alarm-actions "arn:aws:sns:us-east-1:123456789:dns-alerts"
  
  ## 6.3 Prometheus/Grafana Monitoring
  
  # prometheus.yml scrape config for BIND
  - job_name: 'bind'
    static_configs:
      - targets: ['ns1.example.com:8053']
    metrics_path: /metrics
  
  # Alert rules
  groups:
  - name: dns-alerts
    rules:
    - alert: DNSQueryLatencyHigh
      expr: dns_query_latency_seconds > 0.5
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "DNS query latency exceeds 500ms"
    
    - alert: DNSSECValidationFailure
      expr: increase(dns_dnssec_validation_failures_total[5m]) > 0
      labels:
        severity: critical
      annotations:
        summary: "DNSSEC validation failures detected"
    
    - alert: ZoneTransferFailure
      expr: increase(dns_zone_transfer_failures_total[1h]) > 0
      labels:
        severity: warning
      annotations:
        summary: "Zone transfer to secondary failed"

# Test cases for validation
fail_to_pass:
  - "test_dnssec_enabled"
  - "test_registrar_locked"
  - "test_no_subdomain_takeover"
  - "test_zone_transfer_restricted"
  - "test_caa_records_present"
  - "test_rebinding_protected"
  - "test_monitoring_active"

pass_to_pass:
  - "test_dns_resolves"
  - "test_records_correct"
  - "test_failover_works"
  - "test_dnssec_validates"

# Variables for task generation
variables:
  - name: scenario_type
    type: string
    options: 
      - "corporate"
      - "e-commerce"
      - "SaaS"
      - "financial services"
      - "healthcare"
      - "government"
  
  - name: dns_provider
    type: string
    options: ["BIND", "PowerDNS", "AWS Route 53", "GCP Cloud DNS", "Azure DNS", "Cloudflare"]
  
  - name: path
    type: path
    generator: random_path
  
  - name: zone_count
    type: int
    min: 1
    max: 100
  
  - name: record_count
    type: int
    min: 10
    max: 10000
  
  - name: domain_count
    type: int
    min: 1
    max: 50
  
  - name: dnssec_status
    type: string
    options: ["not deployed", "signing only", "signing + validation", "fully deployed"]
  
  - name: dangling_count
    type: int
    min: 0
    max: 50
  
  - name: open_transfers
    type: int
    min: 0
    max: 10
  
  - name: missing_caa
    type: int
    min: 0
    max: 50
  
  - name: validation_failures
    type: int
    min: 0
    max: 100
  
  - name: compliance_frameworks
    type: list
    options: ["FedRAMP", "PCI-DSS", "HIPAA", "SOC2", "ISO27001"]
  
  - name: availability_target
    type: string
    options: ["99.9%", "99.99%", "99.999%"]
  
  - name: task_steps
    type: template
    value: |
      1. Audit current DNS configuration
      2. Implement DNSSEC signing
      3. Configure DNSSEC validation
      4. Restrict zone transfers with TSIG
      5. Add CAA records for all domains
      6. Audit and remediate dangling records
      7. Implement DNS rebinding protection
      8. Configure DNS firewalls/RPZ
      9. Set up monitoring and alerting
      10. Secure registrar accounts
      11. Document incident response
      12. Test failover procedures

# Anti-hardcoding measures
anti_hardcoding:
  canary_tokens: true
  randomize_paths: true
  dynamic_content: true
  dns_vulnerabilities:
    - no_dnssec
    - registrar_compromise
    - subdomain_takeover
    - zone_transfer_open
    - rebinding_vulnerable
    - caa_missing

# Anti-patterns for LLM failure modes
anti_patterns:
  llm_failure_modes:
    - "Applying generic DevOps patterns without cloud-specific considerations"
    - "Missing container runtime security boundaries"
    - "Ignoring network policy interactions in Kubernetes"
    - "Not considering eventual consistency in distributed config management"
    - "Missing hidden resource contention in shared infrastructure"
    - "Overlooking DNS TTL and caching layer interactions"
    - "Assuming CI/CD tools handle secrets securely by default"
    - "Missing supply chain attack vectors in dependency management"
    - "Ignoring infrastructure drift detection gaps"
    - "Assuming DNSSEC alone prevents all DNS attacks"
    - "Not understanding the difference between NSEC and NSEC3 zone walking"
    - "Recommending CAA without understanding wildcard certificate issuance"
    - "Ignoring TTL caching implications during incident response"
    - "Assuming DNS over HTTPS/TLS prevents DNS rebinding"
    - "Not understanding Kubernetes ndots and search domain performance impact"
    - "Missing the impact of split-horizon DNS on DNSSEC validation"
    - "Recommending zone transfers without TSIG authentication"
    - "Ignoring glue record requirements for nameserver delegation"
    - "Assuming DNS failover provides instantaneous recovery"
    - "Not understanding CNAME flattening implications for DNSSEC"
    - "Missing the security implications of DNS rebinding with short TTLs"
    - "Recommending anycast without understanding catchment area implications"
    - "Ignoring EDNS0 client subnet privacy implications"
    - "Assuming registrar lock prevents all hijacking vectors"
    - "Not understanding the timing requirements for DNSSEC key rollover"
    - "Missing BGP route origin validation requirements for DNS infrastructure"
    - "Recommending DNS firewalls without understanding bypass techniques"
    - "Ignoring the impact of recursive resolver caching on security changes"

# Evaluation metrics
evaluation:
  security_score:
    weight: 0.45
    metrics:
      - "DNSSEC properly deployed"
      - "Zone transfers restricted"
      - "No dangling records"
      - "CAA records configured"
  
  availability_score:
    weight: 0.30
    metrics:
      - "Redundant nameservers"
      - "Anycast deployed"
      - "Failover tested"
  
  compliance_score:
    weight: 0.25
    metrics:
      - "Audit logging enabled"
      - "Change management documented"
      - "Incident response defined"
