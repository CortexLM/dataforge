id: breadboard-ai/breadboard-7818
repo: breadboard-ai/breadboard
base_commit: c1b05bc3dcff9bd6682e867f6a37922b5e4ed22e
merge_commit: 38cad4465608c7b506c1a3d14afae348900ebbbb
language: typescript
difficulty_score: 3
created_at: 2026-02-14T14:36:59.732498299Z
patch: "diff --git a/packages/types/src/inspect.ts b/packages/types/src/inspect.ts\nindex 0c6b63678b8..ea425c446b7 100644\n--- a/packages/types/src/inspect.ts\n+++ b/packages/types/src/inspect.ts\n@@ -34,10 +34,7 @@ import { GraphLoader } from \"./loader.js\";\n import { NodeDescriberResult, NodeHandlerMetadata } from \"./node-handler.js\";\n import { RunnableModuleFactory } from \"./sandbox.js\";\n import { BehaviorSchema, Schema } from \"./schema.js\";\n-import {\n-  TypedEventTarget,\n-  TypedEventTargetType,\n-} from \"./typed-event-target.js\";\n+\n import { UUID } from \"./uuid.js\";\n import { RuntimeFlagManager } from \"./flags.js\";\n \n@@ -697,18 +694,6 @@ export type InspectableDescriberResultCacheEntry = {\n   updating: boolean;\n };\n \n-export type DescribeResultTypeCacheArgs = {\n-  initial(): NodeDescriberResult;\n-  latest(type: NodeTypeIdentifier): Promise<NodeDescriberResult>;\n-  updated(type: NodeTypeIdentifier): void;\n-};\n-\n-export type InspectableDescriberResultTypeCache = {\n-  get(type: NodeTypeIdentifier): InspectableDescriberResultCacheEntry;\n-  update(affectedTypes: NodeTypeIdentifier[]): void;\n-  clear(): void;\n-};\n-\n export type InspectableDescriberResultCache = {\n   get(\n     id: NodeIdentifier,\n@@ -747,24 +732,8 @@ export type GraphStoreArgs = Required<InspectableGraphOptions> & {\n   flags: RuntimeFlagManager;\n };\n \n-export type GraphStoreUpdateEvent = Event & {\n-  mainGraphId: MainGraphIdentifier;\n-  affectedGraphs: MainGraphIdentifier[];\n-  graphId: GraphIdentifier;\n-  nodeId: NodeIdentifier;\n-  topologyChange: boolean;\n-};\n-\n-type GraphsStoreEventMap = {\n-  update: GraphStoreUpdateEvent;\n-};\n-\n-export type GraphStoreEventTarget = TypedEventTarget<GraphsStoreEventMap>;\n-\n-export type MutableGraphStore = TypedEventTargetType<GraphsStoreEventMap> & {\n-  readonly types: InspectableDescriberResultTypeCache;\n-\n-  set(graph: GraphDescriptor): void;\n+export type MutableGraphStore = {\n+  set(graph: MutableGraph): void;\n   get(): MutableGraph | undefined;\n };\n \ndiff --git a/packages/visual-editor/src/engine/inspector/graph-store.ts b/packages/visual-editor/src/engine/inspector/graph-store.ts\ndeleted file mode 100644\nindex da6e598a8c0..00000000000\n--- a/packages/visual-editor/src/engine/inspector/graph-store.ts\n+++ /dev/null\n@@ -1,55 +0,0 @@\n-/**\n- * @license\n- * Copyright 2024 Google LLC\n- * SPDX-License-Identifier: Apache-2.0\n- */\n-\n-import type {\n-  GraphDescriptor,\n-  GraphStoreArgs,\n-  GraphStoreEventTarget,\n-  InspectableDescriberResultTypeCache,\n-  MutableGraph,\n-  MutableGraphStore,\n-} from \"@breadboard-ai/types\";\n-\n-import { DescribeResultTypeCache } from \"./graph/describe-type-cache.js\";\n-\n-import { MutableGraphImpl } from \"./graph/mutable-graph.js\";\n-import { NodeTypeDescriberManager } from \"./graph/node-type-describer-manager.js\";\n-\n-export { GraphStore };\n-\n-class GraphStore\n-  extends (EventTarget as GraphStoreEventTarget)\n-  implements MutableGraphStore\n-{\n-  #deps: GraphStoreArgs;\n-  #mutable: MutableGraph | undefined;\n-\n-  /**\n-   * The cache of type describer results. These are currently\n-   * entirely static: they are only loaded once and exist\n-   * for the lifetime of the GraphStore. At the moment, this\n-   * is ok, since the only graph that ever changes is the main\n-   * graph, and we don't need its type. This will change\n-   * probably, so we need to be on look out for when.\n-   */\n-  public readonly types: InspectableDescriberResultTypeCache;\n-\n-  constructor(args: GraphStoreArgs) {\n-    super();\n-    this.#deps = args;\n-    this.types = new DescribeResultTypeCache(\n-      new NodeTypeDescriberManager(this, args)\n-    );\n-  }\n-\n-  set(graph: GraphDescriptor): void {\n-    this.#mutable = new MutableGraphImpl(graph, this, this.#deps);\n-  }\n-\n-  get(): MutableGraph | undefined {\n-    return this.#mutable;\n-  }\n-}\ndiff --git a/packages/visual-editor/src/engine/inspector/graph/describe-type-cache.ts b/packages/visual-editor/src/engine/inspector/graph/describe-type-cache.ts\ndeleted file mode 100644\nindex 7b6de4cab65..00000000000\n--- a/packages/visual-editor/src/engine/inspector/graph/describe-type-cache.ts\n+++ /dev/null\n@@ -1,47 +0,0 @@\n-/**\n- * @license\n- * Copyright 2024 Google LLC\n- * SPDX-License-Identifier: Apache-2.0\n- */\n-\n-import {\n-  DescribeResultTypeCacheArgs,\n-  InspectableDescriberResultCacheEntry,\n-  InspectableDescriberResultTypeCache,\n-  NodeDescriberResult,\n-  NodeTypeIdentifier,\n-} from \"@breadboard-ai/types\";\n-import { SnapshotUpdater } from \"@breadboard-ai/utils\";\n-\n-export { DescribeResultTypeCache };\n-\n-type MapItem = SnapshotUpdater<NodeDescriberResult>;\n-\n-class DescribeResultTypeCache implements InspectableDescriberResultTypeCache {\n-  #map = new Map<NodeTypeIdentifier, MapItem>();\n-\n-  constructor(public readonly args: DescribeResultTypeCacheArgs) {}\n-\n-  get(type: NodeTypeIdentifier): InspectableDescriberResultCacheEntry {\n-    let result = this.#map.get(type);\n-    if (result) {\n-      return result.snapshot();\n-    }\n-    result = new SnapshotUpdater({\n-      initial: () => this.args.initial(),\n-      latest: () => this.args.latest(type),\n-      updated: () => this.args.updated(type),\n-    });\n-    this.#map.set(type, result);\n-    return result.snapshot();\n-  }\n-\n-  update(affectedTypes: NodeTypeIdentifier[]): void {\n-    for (const type of affectedTypes) {\n-      this.#map.delete(type);\n-    }\n-  }\n-  clear(): void {\n-    this.#map.clear();\n-  }\n-}\ndiff --git a/packages/visual-editor/src/engine/inspector/graph/event.ts b/packages/visual-editor/src/engine/inspector/graph/event.ts\ndeleted file mode 100644\nindex 23d508ee4e1..00000000000\n--- a/packages/visual-editor/src/engine/inspector/graph/event.ts\n+++ /dev/null\n@@ -1,34 +0,0 @@\n-/**\n- * @license\n- * Copyright 2024 Google LLC\n- * SPDX-License-Identifier: Apache-2.0\n- */\n-\n-import {\n-  GraphIdentifier,\n-  GraphStoreUpdateEvent,\n-  MainGraphIdentifier,\n-  NodeIdentifier,\n-} from \"@breadboard-ai/types\";\n-\n-export { UpdateEvent };\n-\n-const eventInit = {\n-  bubbles: true,\n-  cancelable: true,\n-  composed: true,\n-};\n-\n-class UpdateEvent extends Event implements GraphStoreUpdateEvent {\n-  static eventName = \"update\";\n-\n-  constructor(\n-    public readonly mainGraphId: MainGraphIdentifier,\n-    public readonly graphId: GraphIdentifier,\n-    public readonly nodeId: NodeIdentifier,\n-    public readonly affectedGraphs: MainGraphIdentifier[],\n-    public readonly topologyChange: boolean\n-  ) {\n-    super(UpdateEvent.eventName, { ...eventInit });\n-  }\n-}\ndiff --git a/packages/visual-editor/src/engine/inspector/graph/mutable-graph.ts b/packages/visual-editor/src/engine/inspector/graph/mutable-graph.ts\nindex f399d8abd9a..c9581a6fa55 100644\n--- a/packages/visual-editor/src/engine/inspector/graph/mutable-graph.ts\n+++ b/packages/visual-editor/src/engine/inspector/graph/mutable-graph.ts\n@@ -25,7 +25,7 @@ import type {\n import { DescribeResultCache } from \"./describe-cache.js\";\n import { EdgeCache } from \"./edge-cache.js\";\n import { Edge as InspectableEdge } from \"./edge.js\";\n-import { UpdateEvent } from \"./event.js\";\n+\n import { GraphCache } from \"./graph-cache.js\";\n import { Graph } from \"./graph.js\";\n import { ModuleCache } from \"./module.js\";\n@@ -72,7 +72,7 @@ class MutableGraphImpl implements MutableGraph {\n     visualOnly: boolean,\n     affectedNodes: AffectedNode[],\n     affectedModules: ModuleIdentifier[],\n-    topologyChange: boolean\n+    _topologyChange: boolean\n   ): void {\n     // TODO: Handle this a better way?\n     for (const id of affectedModules) {\n@@ -103,9 +103,6 @@ class MutableGraphImpl implements MutableGraph {\n     // TODO: Handle removals, etc.\n     if (!visualOnly) {\n       this.describe.update(affectedNodes);\n-      this.store.dispatchEvent(\n-        new UpdateEvent(this.id, \"\", \"\", [], topologyChange)\n-      );\n     }\n     this.entries = findEntries(graph);\n     this.graph = graph;\ndiff --git a/packages/visual-editor/src/engine/inspector/graph/node-describer-manager.ts b/packages/visual-editor/src/engine/inspector/graph/node-describer-manager.ts\nindex 043958a5344..31046bcf99d 100644\n--- a/packages/visual-editor/src/engine/inspector/graph/node-describer-manager.ts\n+++ b/packages/visual-editor/src/engine/inspector/graph/node-describer-manager.ts\n@@ -22,7 +22,6 @@ import type {\n   NodeTypeIdentifier,\n } from \"@breadboard-ai/types\";\n import { SchemaDiffer } from \"@breadboard-ai/utils\";\n-import { UpdateEvent } from \"./event.js\";\n \n import {\n   describeInput,\n@@ -106,10 +105,9 @@ class NodeDescriberManager implements DescribeResultCacheArgs {\n     }\n   }\n \n-  updated(graphId: GraphIdentifier, nodeId: NodeIdentifier): void {\n-    this.mutable.store.dispatchEvent(\n-      new UpdateEvent(this.mutable.id, graphId, nodeId, [], false)\n-    );\n+  updated(_graphId: GraphIdentifier, _nodeId: NodeIdentifier): void {\n+    // Node type descriptions are now tracked via GraphController.topologyVersion,\n+    // so no event dispatch is needed here.\n   }\n \n   async #getDescriber(\ndiff --git a/packages/visual-editor/src/engine/inspector/graph/node-type-describer-manager.ts b/packages/visual-editor/src/engine/inspector/graph/node-type-describer-manager.ts\ndeleted file mode 100644\nindex ec6883d025d..00000000000\n--- a/packages/visual-editor/src/engine/inspector/graph/node-type-describer-manager.ts\n+++ /dev/null\n@@ -1,129 +0,0 @@\n-/**\n- * @license\n- * Copyright 2025 Google LLC\n- * SPDX-License-Identifier: Apache-2.0\n- */\n-\n-import type {\n-  DescribeResultTypeCacheArgs,\n-  GraphDescriptor,\n-  GraphStoreArgs,\n-  MutableGraphStore,\n-  NodeDescriberContext,\n-  NodeDescriberFunction,\n-  NodeDescriberResult,\n-  NodeHandler,\n-  NodeHandlerContext,\n-  NodeTypeIdentifier,\n-} from \"@breadboard-ai/types\";\n-import { createLoader } from \"../../loader/index.js\";\n-import { SENTINEL_BASE_URL } from \"../../loader/loader.js\";\n-import { getHandler } from \"../../runtime/legacy.js\";\n-import { UpdateEvent } from \"./event.js\";\n-import { emptyResult, NodeDescriberManager } from \"./node-describer-manager.js\";\n-import { describeInput, describeOutput } from \"./schemas.js\";\n-import {\n-  assetsFromGraphDescriptor,\n-  envFromGraphDescriptor,\n-} from \"../../../data/file-system.js\";\n-\n-export { NodeTypeDescriberManager };\n-\n-const PLACEHOLDER_ID = crypto.randomUUID();\n-\n-const TYPE_DESCRIPTOR_GRAPH_URL = SENTINEL_BASE_URL.href;\n-\n-class NodeTypeDescriberManager implements DescribeResultTypeCacheArgs {\n-  #deps: GraphStoreArgs;\n-\n-  constructor(\n-    public readonly store: MutableGraphStore,\n-    deps: GraphStoreArgs\n-  ) {\n-    this.#deps = deps;\n-  }\n-\n-  initial(): NodeDescriberResult {\n-    return emptyResult();\n-  }\n-\n-  updated(): void {\n-    this.store.dispatchEvent(\n-      new UpdateEvent(PLACEHOLDER_ID, \"\", \"\", [], false)\n-    );\n-  }\n-\n-  latest(type: NodeTypeIdentifier): Promise<NodeDescriberResult> {\n-    return this.getLatestDescription(type);\n-  }\n-\n-  async getLatestDescription(type: NodeTypeIdentifier) {\n-    // The schema of an input or an output is defined by their\n-    // configuration schema or their incoming/outgoing edges.\n-    if (type === \"input\") {\n-      return describeInput({});\n-    }\n-    if (type === \"output\") {\n-      return describeOutput({});\n-    }\n-\n-    const describer = await this.#getDescriber(type);\n-    const asWired = NodeDescriberManager.asWired();\n-    if (!describer) {\n-      return asWired;\n-    }\n-    const loader = this.#deps.loader || createLoader();\n-    // When describing types, we provide a weird empty graph with a special URL\n-    // because we're not actually inside of any graph, and that is ok.\n-    const outerGraph: GraphDescriptor = {\n-      nodes: [],\n-      edges: [],\n-      url: TYPE_DESCRIPTOR_GRAPH_URL,\n-    };\n-    const context: NodeDescriberContext = {\n-      outerGraph,\n-      loader,\n-      sandbox: this.#deps.sandbox,\n-      graphStore: this.store,\n-      fileSystem: this.#deps.fileSystem.createRunFileSystem({\n-        graphUrl: TYPE_DESCRIPTOR_GRAPH_URL,\n-        env: envFromGraphDescriptor(this.#deps.fileSystem.env()),\n-        assets: assetsFromGraphDescriptor(),\n-      }),\n-      wires: { incoming: {}, outgoing: {} },\n-      asType: true,\n-      flags: this.#deps.flags,\n-    };\n-    try {\n-      return describer(\n-        undefined,\n-        asWired.inputSchema,\n-        asWired.outputSchema,\n-        context\n-      );\n-    } catch (e) {\n-      console.warn(`Error describing node type ${type}`, e);\n-      return asWired;\n-    }\n-  }\n-\n-  async #getDescriber(\n-    type: NodeTypeIdentifier\n-  ): Promise<NodeDescriberFunction | undefined> {\n-    let handler: NodeHandler | undefined;\n-    const context: NodeHandlerContext = {\n-      loader: this.#deps.loader,\n-      sandbox: this.#deps.sandbox,\n-      graphStore: this.store,\n-    };\n-    try {\n-      handler = await getHandler(type, context);\n-    } catch (e) {\n-      console.warn(`Error getting describer for node type ${type}`, e);\n-    }\n-    if (!handler || !(\"describe\" in handler) || !handler.describe) {\n-      return undefined;\n-    }\n-    return handler.describe;\n-  }\n-}\ndiff --git a/packages/visual-editor/src/engine/inspector/index.ts b/packages/visual-editor/src/engine/inspector/index.ts\ndeleted file mode 100644\nindex cfa79a5c989..00000000000\n--- a/packages/visual-editor/src/engine/inspector/index.ts\n+++ /dev/null\n@@ -1,12 +0,0 @@\n-/**\n- * @license\n- * Copyright 2024 Google LLC\n- * SPDX-License-Identifier: Apache-2.0\n- */\n-\n-import type { GraphStoreArgs, MutableGraphStore } from \"@breadboard-ai/types\";\n-import { GraphStore } from \"./graph-store.js\";\n-\n-export function createGraphStore(args: GraphStoreArgs): MutableGraphStore {\n-  return new GraphStore(args);\n-}\ndiff --git a/packages/visual-editor/src/main-base.ts b/packages/visual-editor/src/main-base.ts\nindex 261a0c0563c..b12e2809269 100644\n--- a/packages/visual-editor/src/main-base.ts\n+++ b/packages/visual-editor/src/main-base.ts\n@@ -117,26 +117,13 @@ abstract class MainBase extends SignalWatcher(LitElement) {\n   }\n \n   /**\n-   * Monotonically increases whenever the graph topology of a graph in the\n-   * current tab changes. Graph topology == any non-visual change to the graph.\n-   * - this property is incremented whenever the \"update\" event is received\n-   *   from the `GraphStore` instance, which stores and tracks all known graphs,\n-   *   across all tabs, etc.\n-   * - this property is only incremented when the \"update\" is for the current\n-   *   tab's graph, but that still works when we switch tabs, since we don't\n-   *   check the value of the property, just whether it changed.\n-   * - because it is decorated with `@state()` on this component,\n-   *   incrementing this property causes a new render of the component.\n-   * - this property is then passed to various sub-components that need to be\n-   *   aware of graph topology changes.\n-   * - these sub-components need to have their own `graphTopologyUpdateId` that\n-   *   should be decorated as `@property()`, so that the change to this property\n-   *   causes a new render of that component, too.\n-   * - as the resulting effect, incrementing the property will keep the parts\n-   *   of the UI that need to reflect the latest graph topology up to date.\n+   * @deprecated Use sca.controller.editor.graph.topologyVersion instead.\n+   * Kept as a @state() only to avoid breaking sub-components that still\n+   * receive it as a @property().\n    */\n-  @state()\n-  accessor graphTopologyUpdateId: number = 0;\n+  get graphTopologyUpdateId(): number {\n+    return this.sca.controller.editor.graph.topologyVersion;\n+  }\n \n   @state()\n   protected accessor tosStatus: CheckAppAccessResponse | null = null;\n@@ -265,18 +252,6 @@ abstract class MainBase extends SignalWatcher(LitElement) {\n     admin.runtime = this.runtime;\n     admin.settingsHelper = this.settingsHelper;\n \n-    this.sca.services.graphStore.addEventListener(\"update\", (evt) => {\n-      const { mainGraphId } = evt;\n-      const current = this.tab?.mainGraphId;\n-      if (\n-        !current ||\n-        (mainGraphId !== current && !evt.affectedGraphs.includes(current))\n-      ) {\n-        return;\n-      }\n-      this.graphTopologyUpdateId++;\n-    });\n-\n     // Once we've determined the sign-in status, relay it to an embedder.\n     this.sca.services.signinAdapter.state.then((state) =>\n       this.sca.services.embedHandler?.sendToEmbedder({\ndiff --git a/packages/visual-editor/src/sca/actions/board/board-actions.ts b/packages/visual-editor/src/sca/actions/board/board-actions.ts\nindex 19a91cdc4f3..57c743a50e5 100644\n--- a/packages/visual-editor/src/sca/actions/board/board-actions.ts\n+++ b/packages/visual-editor/src/sca/actions/board/board-actions.ts\n@@ -490,7 +490,7 @@ export const load = asAction(\n     }\n \n     // 8. Initialize the editor\n-    Helpers.initializeEditor(services.graphStore, controller.editor.graph, {\n+    Helpers.initializeEditor(controller.editor.graph, {\n       graph: prepared.graph,\n       moduleId: prepared.moduleId,\n       subGraphId: prepared.subGraphId,\n@@ -503,6 +503,12 @@ export const load = asAction(\n       onHistoryChanged: (h) =>\n         controller.board.main.saveEditHistory(resolvedUrl, h),\n       finalOutputValues,\n+      graphStoreArgs: {\n+        loader: services.loader,\n+        sandbox: services.sandbox,\n+        fileSystem: services.fileSystem,\n+        flags: controller.global.flags,\n+      },\n     });\n \n     // 9. Update theme hash for the newly loaded graph\ndiff --git a/packages/visual-editor/src/sca/actions/board/helpers/initialize-editor.ts b/packages/visual-editor/src/sca/actions/board/helpers/initialize-editor.ts\nindex 8ac6d9ab5d2..ee822791643 100644\n--- a/packages/visual-editor/src/sca/actions/board/helpers/initialize-editor.ts\n+++ b/packages/visual-editor/src/sca/actions/board/helpers/initialize-editor.ts\n@@ -9,12 +9,13 @@ import type {\n   EditHistoryEntry,\n   GraphDescriptor,\n   GraphIdentifier,\n+  GraphStoreArgs,\n   ModuleIdentifier,\n-  MutableGraphStore,\n   OutputValues,\n } from \"@breadboard-ai/types\";\n import { Graph as GraphEditor } from \"../../../../engine/editor/graph.js\";\n import type * as Editor from \"../../../controller/subcontrollers/editor/editor.js\";\n+import { MutableGraphImpl } from \"../../../../engine/inspector/graph/mutable-graph.js\";\n \n /**\n  * Options for initializing the editor.\n@@ -41,6 +42,8 @@ export interface InitializeEditorOptions {\n   onHistoryChanged?: (history: Readonly<EditHistoryEntry[]>) => void;\n   /** Pre-loaded final output values */\n   finalOutputValues?: OutputValues;\n+  /** Dependencies for creating MutableGraphImpl */\n+  graphStoreArgs: GraphStoreArgs;\n }\n \n /**\n@@ -56,18 +59,17 @@ export interface InitializeEditorResult {\n  * Sets up the editor state for a loaded graph.\n  *\n  * This function:\n- * - Sets the graph in the graph store\n+ * - Creates a MutableGraphImpl from the graph descriptor\n+ * - Stores it in the graph controller\n  * - Creates an editor instance\n  * - Wires up event listeners for graph changes\n  * - Updates the graph controller state\n  *\n- * @param graphStore The mutable graph store\n  * @param graphController The graph controller to update\n  * @param options Editor initialization options\n  * @returns The editor ID\n  */\n export function initializeEditor(\n-  graphStore: MutableGraphStore,\n   graphController: Editor.Graph.GraphController,\n   options: InitializeEditorOptions\n ): InitializeEditorResult {\n@@ -80,16 +82,12 @@ export function initializeEditor(\n     creator,\n     history,\n     onHistoryChanged,\n+    graphStoreArgs,\n   } = options;\n \n-  // Set graph in store\n-  graphStore.set(graph);\n-\n-  // Create editor\n-  const mutable = graphStore.get();\n-  if (!mutable) {\n-    throw new Error(\"Unable to create editor\");\n-  }\n+  // Create MutableGraphImpl and store in controller\n+  const mutable = new MutableGraphImpl(graph, graphController, graphStoreArgs);\n+  graphController.set(mutable);\n   const editor = new GraphEditor(mutable, {\n     creator,\n     history,\ndiff --git a/packages/visual-editor/src/sca/actions/run/run-actions.ts b/packages/visual-editor/src/sca/actions/run/run-actions.ts\nindex 862e3500f02..ffaaa4c1863 100644\n--- a/packages/visual-editor/src/sca/actions/run/run-actions.ts\n+++ b/packages/visual-editor/src/sca/actions/run/run-actions.ts\n@@ -154,7 +154,7 @@ export const prepare = asAction(\n       runner: graph,\n       diagnostics: true,\n       loader: services.loader,\n-      graphStore: services.graphStore,\n+      graphStore: controller.editor.graph,\n       sandbox: services.sandbox,\n       fileSystem,\n       // TODO: Remove this. Inputs from Settings is no longer a thing.\n@@ -245,7 +245,7 @@ export const prepare = asAction(\n         controller.run.main.setEstimatedEntryCount(nodeIds.length);\n \n         // Pre-populate console with all graph nodes as \"inactive\" in execution order\n-        const inspectable = services.graphStore.get()?.graphs.get(\"\");\n+        const inspectable = controller.editor.graph.get()?.graphs.get(\"\");\n         if (inspectable) {\n           for (const nodeId of nodeIds) {\n             const node = inspectable?.nodeById(nodeId);\n@@ -289,7 +289,7 @@ export const prepare = asAction(\n       if (event.data.path.length > 1) return;\n \n       const nodeId = event.data.node.id;\n-      const inspectable = services.graphStore.get()?.graphs.get(\"\");\n+      const inspectable = controller.editor.graph.get()?.graphs.get(\"\");\n       const node = inspectable?.nodeById(nodeId);\n       const title = node?.title() ?? nodeId;\n       const metadata = node?.currentDescribe()?.metadata ?? {};\n@@ -380,7 +380,7 @@ export const syncConsoleFromRunner = asAction(\n     triggeredBy: () => onGraphVersionForSync(bind),\n   },\n   async (): Promise<void> => {\n-    const { controller, services } = bind;\n+    const { controller } = bind;\n     const runController = controller.run.main;\n     const graphController = controller.editor.graph;\n \n@@ -406,7 +406,7 @@ export const syncConsoleFromRunner = asAction(\n       return;\n     }\n \n-    const inspectable = services.graphStore.get()?.graphs.get(\"\");\n+    const inspectable = controller.editor.graph.get()?.graphs.get(\"\");\n     if (!inspectable) {\n       return;\n     }\ndiff --git a/packages/visual-editor/src/sca/controller/subcontrollers/editor/graph/graph-controller.ts b/packages/visual-editor/src/sca/controller/subcontrollers/editor/graph/graph-controller.ts\nindex 1c0d33d7559..f2a946e3a1b 100644\n--- a/packages/visual-editor/src/sca/controller/subcontrollers/editor/graph/graph-controller.ts\n+++ b/packages/visual-editor/src/sca/controller/subcontrollers/editor/graph/graph-controller.ts\n@@ -15,6 +15,8 @@ import {\n   GraphTheme,\n   InspectableGraph,\n   InspectableNodePorts,\n+  MutableGraph,\n+  MutableGraphStore,\n   NodeConfiguration,\n   NodeHandlerMetadata,\n   NodeIdentifier,\n@@ -94,7 +96,25 @@ const NOTEBOOKLM_TOOL: Tool = {\n   icon: notebookLmIcon,\n };\n \n-export class GraphController extends RootController {\n+export class GraphController\n+  extends RootController\n+  implements MutableGraphStore\n+{\n+  #mutableGraph: MutableGraph | undefined;\n+\n+  /**\n+   * MutableGraphStore.set — stores the given MutableGraph.\n+   */\n+  set(graph: MutableGraph): void {\n+    this.#mutableGraph = graph;\n+  }\n+\n+  /**\n+   * MutableGraphStore.get — returns the current MutableGraph.\n+   */\n+  get(): MutableGraph | undefined {\n+    return this.#mutableGraph;\n+  }\n   /**\n    * Static registry of A2 tools. These are environment-independent\n    * and don't change based on graph content.\n@@ -152,6 +172,14 @@ export class GraphController extends RootController {\n   @field()\n   accessor version = 0;\n \n+  /**\n+   * Monotonically increases on non-visual graph topology changes.\n+   * Used by UI components to detect when the graph structure has changed\n+   * (as opposed to visual-only changes like node movement).\n+   */\n+  @field()\n+  accessor topologyVersion = 0;\n+\n   @field()\n   accessor lastLoadedVersion = 0;\n \n@@ -307,6 +335,7 @@ export class GraphController extends RootController {\n     // Skip derived tools update on visual-only changes (e.g., node movement)\n     if (evt.visualOnly) return;\n \n+    this.topologyVersion++;\n     this.#updateMyTools();\n     this.#updateAgentModeTools();\n     this.#updateComponents();\ndiff --git a/packages/visual-editor/src/sca/sca.ts b/packages/visual-editor/src/sca/sca.ts\nindex 7f4f00554f7..0b2971b5a1c 100644\n--- a/packages/visual-editor/src/sca/sca.ts\n+++ b/packages/visual-editor/src/sca/sca.ts\n@@ -26,7 +26,7 @@\n  * - Typically stateless (with respect to the UI).\n  * - Injected once at application boot.\n  * - Held in `app.services` but rarely accessed directly by the UI.\n- * - **Examples:** `FileSystem`, `GraphStore`, `Autonamer`, `GoogleDriveClient`.\n+ * - **Examples:** `FileSystem`, `Autonamer`, `GoogleDriveClient`.\n  *\n  * ## 2. Controllers (The \"State\")\n  * **Role:** The reactive source of truth.\n@@ -121,6 +121,7 @@ export function sca(config: RuntimeConfig, flags: RuntimeFlags) {\n       controller.global.flags,\n       () => controller.global.consent\n     );\n+\n     const actions = Actions.actions(controller, services);\n \n     instance = {\ndiff --git a/packages/visual-editor/src/sca/services/services.ts b/packages/visual-editor/src/sca/services/services.ts\nindex 1dd4f72d7dd..bd812300a0e 100644\n--- a/packages/visual-editor/src/sca/services/services.ts\n+++ b/packages/visual-editor/src/sca/services/services.ts\n@@ -36,7 +36,6 @@ import { AgentContext } from \"../../a2/agent/agent-context.js\";\n import { createGoogleDriveBoardServer } from \"../../ui/utils/create-server.js\";\n import { createA2Server } from \"../../a2/index.js\";\n import { createLoader } from \"../../engine/loader/index.js\";\n-import { createGraphStore } from \"../../engine/inspector/index.js\";\n import { Autonamer } from \"./autonamer.js\";\n import { AppCatalystApiClient } from \"../../ui/flow-gen/app-catalyst.js\";\n import { EmailPrefsManager } from \"../../ui/utils/email-prefs-manager.js\";\n@@ -71,7 +70,6 @@ export interface AppServices {\n   flowGenerator: FlowGenerator;\n   googleDriveBoardServer: GoogleDriveBoardServer;\n   googleDriveClient: GoogleDriveClient;\n-  graphStore: ReturnType<typeof createGraphStore>;\n   loader: GraphLoader;\n   mcpClientManager: McpClientManager;\n   integrationManagers: IntegrationManagerService;\n@@ -175,8 +173,6 @@ export function services(\n       flags,\n     };\n \n-    const graphStore = createGraphStore(graphStoreArgs);\n-\n     const autonamer = new Autonamer(graphStoreArgs, fileSystem, sandbox);\n     const apiClient = new AppCatalystApiClient(\n       fetchWithCreds,\n@@ -202,7 +198,6 @@ export function services(\n       flowGenerator,\n       googleDriveBoardServer,\n       googleDriveClient,\n-      graphStore,\n       integrationManagers: new IntegrationManagerService(),\n       loader,\n       mcpClientManager,\ndiff --git a/packages/visual-editor/tests/helpers/_editor.ts b/packages/visual-editor/tests/helpers/_editor.ts\nindex 0513ef4a08b..bc0842ae920 100644\n--- a/packages/visual-editor/tests/helpers/_editor.ts\n+++ b/packages/visual-editor/tests/helpers/_editor.ts\n@@ -8,11 +8,11 @@ import {\n   EditableGraph,\n   EditableGraphOptions,\n   GraphDescriptor,\n+  MutableGraphStore,\n } from \"@breadboard-ai/types\";\n import { MutableGraphImpl } from \"../../src/engine/inspector/graph/mutable-graph.js\";\n import { Graph } from \"../../src/engine/editor/graph.js\";\n import { makeTestGraphStore, makeTestGraphStoreArgs } from \"./_graph-store.js\";\n-import type { GraphStore } from \"../../src/engine/inspector/graph-store.js\";\n \n export { editGraphStore };\n \n@@ -31,7 +31,7 @@ export const editGraph = (\n  * Test helper replacing the removed `graphStore.edit()` method.\n  */\n function editGraphStore(\n-  graphStore: GraphStore,\n+  graphStore: MutableGraphStore,\n   options: EditableGraphOptions = {}\n ): EditableGraph | undefined {\n   const mutable = graphStore.get();\ndiff --git a/packages/visual-editor/tests/helpers/_graph-store.ts b/packages/visual-editor/tests/helpers/_graph-store.ts\nindex bb879da82a6..6d131d7dbf4 100644\n--- a/packages/visual-editor/tests/helpers/_graph-store.ts\n+++ b/packages/visual-editor/tests/helpers/_graph-store.ts\n@@ -5,14 +5,17 @@\n  */\n \n import type {\n+  GraphDescriptor,\n   GraphStoreArgs,\n   InspectableGraphOptions,\n+  MutableGraph,\n+  MutableGraphStore,\n   RuntimeFlagManager,\n } from \"@breadboard-ai/types\";\n-import { GraphStore } from \"../../src/engine/inspector/graph-store.js\";\n+import { MutableGraphImpl } from \"../../src/engine/inspector/graph/mutable-graph.js\";\n import { makeFs } from \"../test-file-system.js\";\n \n-export { makeTestGraphStore, makeTestGraphStoreArgs };\n+export { makeTestGraphStore, makeTestGraphStoreArgs, loadGraphIntoStore };\n \n function makeTestGraphStoreArgs(\n   options: InspectableGraphOptions = {}\n@@ -49,6 +52,37 @@ function makeTestGraphStoreArgs(\n   };\n }\n \n-function makeTestGraphStore(args?: GraphStoreArgs) {\n-  return new GraphStore(args ?? makeTestGraphStoreArgs());\n+/**\n+ * Creates a MutableGraphImpl from a descriptor and stores it in the given store.\n+ * Convenience function for tests that need to populate a MutableGraphStore.\n+ */\n+function loadGraphIntoStore(\n+  store: MutableGraphStore,\n+  graph: GraphDescriptor,\n+  args?: GraphStoreArgs\n+): void {\n+  const storeArgs = args ?? makeTestGraphStoreArgs();\n+  const mutable = new MutableGraphImpl(graph, store, storeArgs);\n+  store.set(mutable);\n+}\n+\n+/**\n+ * Creates a test MutableGraphStore for use in unit tests.\n+ * This replaces the deleted GraphStore class with a minimal implementation.\n+ */\n+function makeTestGraphStore(\n+  args?: GraphStoreArgs\n+): MutableGraphStore & { _args: GraphStoreArgs } {\n+  const storeArgs = args ?? makeTestGraphStoreArgs();\n+  let mutableGraph: MutableGraph | undefined;\n+  const store = {\n+    _args: storeArgs,\n+    set(graph: MutableGraph): void {\n+      mutableGraph = graph;\n+    },\n+    get(): MutableGraph | undefined {\n+      return mutableGraph;\n+    },\n+  };\n+  return store;\n }\ndiff --git a/packages/visual-editor/tests/sca/actions/asset/asset-actions.test.ts b/packages/visual-editor/tests/sca/actions/asset/asset-actions.test.ts\nindex 34da4c05daf..a6418940ff7 100644\n--- a/packages/visual-editor/tests/sca/actions/asset/asset-actions.test.ts\n+++ b/packages/visual-editor/tests/sca/actions/asset/asset-actions.test.ts\n@@ -182,8 +182,8 @@ suite(\"Asset Actions\", () => {\n     });\n \n     test(\"returns error when asset has no metadata\", async () => {\n-      const { graphStore, editor } = makeTestGraphStoreWithEditor();\n-      const { services } = makeTestServices({ graphStore });\n+      const { editor } = makeTestGraphStoreWithEditor();\n+      const { services } = makeTestServices();\n \n       const graphAssets = new Map<AssetPath, GraphAsset>();\n       graphAssets.set(\"no-metadata.txt\", {\n@@ -215,8 +215,8 @@ suite(\"Asset Actions\", () => {\n     });\n \n     test(\"returns error when asset not found\", async () => {\n-      const { graphStore, editor } = makeTestGraphStoreWithEditor();\n-      const { services } = makeTestServices({ graphStore });\n+      const { editor } = makeTestGraphStoreWithEditor();\n+      const { services } = makeTestServices();\n \n       const graphAssets = new Map<AssetPath, GraphAsset>();\n \n@@ -239,8 +239,8 @@ suite(\"Asset Actions\", () => {\n     });\n \n     test(\"updates asset title successfully\", async () => {\n-      const { graphStore, editor } = makeTestGraphStoreWithEditor();\n-      const { services } = makeTestServices({ graphStore });\n+      const { editor } = makeTestGraphStoreWithEditor();\n+      const { services } = makeTestServices();\n \n       // Add an asset to the graph first\n       await editor.edit(\n@@ -285,7 +285,7 @@ suite(\"Asset Actions\", () => {\n     });\n \n     test(\"updates asset with data successfully\", async () => {\n-      const { graphStore, editor } = makeTestGraphStoreWithEditor();\n+      const { editor } = makeTestGraphStoreWithEditor();\n \n       // Create mock transformer that returns data unchanged\n       const mockTransformer = {\n@@ -300,7 +300,7 @@ suite(\"Asset Actions\", () => {\n         toFileData: async (_url: URL, part: unknown) => part,\n       };\n \n-      const { services } = makeTestServices({ graphStore });\n+      const { services } = makeTestServices();\n \n       // Add an asset to the graph first\n       await editor.edit(\n@@ -357,7 +357,7 @@ suite(\"Asset Actions\", () => {\n     });\n \n     test(\"returns error when UpdateAssetData fails\", async () => {\n-      const { graphStore, editor } = makeTestGraphStoreWithEditor();\n+      const { editor } = makeTestGraphStoreWithEditor();\n \n       // Create mock transformer\n       const mockTransformer = {\n@@ -372,7 +372,7 @@ suite(\"Asset Actions\", () => {\n         toFileData: async (_url: URL, part: unknown) => part,\n       };\n \n-      const { services } = makeTestServices({ graphStore });\n+      const { services } = makeTestServices();\n \n       // Add asset to graph\n       await editor.edit(\n@@ -658,8 +658,8 @@ suite(\"Asset Actions\", () => {\n     });\n \n     test(\"adds an asset successfully\", async () => {\n-      const { graphStore, editor } = makeTestGraphStoreWithEditor();\n-      const { services } = makeTestServices({ graphStore });\n+      const { editor } = makeTestGraphStoreWithEditor();\n+      const { services } = makeTestServices();\n \n       Asset.bind({\n         services: services as AppServices,\n@@ -690,8 +690,8 @@ suite(\"Asset Actions\", () => {\n     });\n \n     test(\"adds multiple assets in parallel (Promise.all)\", async () => {\n-      const { graphStore, editor } = makeTestGraphStoreWithEditor();\n-      const { services } = makeTestServices({ graphStore });\n+      const { editor } = makeTestGraphStoreWithEditor();\n+      const { services } = makeTestServices();\n \n       Asset.bind({\n         services: services as AppServices,\n@@ -762,8 +762,8 @@ suite(\"Asset Actions\", () => {\n     });\n \n     test(\"sets inlineData title from metadata (L203-204)\", async () => {\n-      const { graphStore, editor } = makeTestGraphStoreWithEditor();\n-      const { services } = makeTestServices({ graphStore });\n+      const { editor } = makeTestGraphStoreWithEditor();\n+      const { services } = makeTestServices();\n \n       // Mock transformer needed because persistDataParts calls\n       // transformer.persistPart on inline data parts\n@@ -851,8 +851,8 @@ suite(\"Asset Actions\", () => {\n     });\n \n     test(\"removes an asset successfully\", async () => {\n-      const { graphStore, editor } = makeTestGraphStoreWithEditor();\n-      const { services } = makeTestServices({ graphStore });\n+      const { editor } = makeTestGraphStoreWithEditor();\n+      const { services } = makeTestServices();\n \n       // First add an asset\n       await editor.edit(\ndiff --git a/packages/visual-editor/tests/sca/actions/board/board-actions.test.ts b/packages/visual-editor/tests/sca/actions/board/board-actions.test.ts\nindex 18a0cba8b01..6c66fc81621 100644\n--- a/packages/visual-editor/tests/sca/actions/board/board-actions.test.ts\n+++ b/packages/visual-editor/tests/sca/actions/board/board-actions.test.ts\n@@ -10,7 +10,7 @@ import * as Board from \"../../../../src/sca/actions/board/board-actions.js\";\n import { AppServices } from \"../../../../src/sca/services/services.js\";\n import { AppController } from \"../../../../src/sca/controller/controller.js\";\n import type { EditHistoryCreator, GraphTheme } from \"@breadboard-ai/types\";\n-import { makeTestGraphStore } from \"../../../helpers/_graph-store.js\";\n+import { makeTestGraphStore, loadGraphIntoStore } from \"../../../helpers/_graph-store.js\";\n import { editGraphStore } from \"../../../helpers/_editor.js\";\n import { SnackType } from \"../../../../src/ui/types/types.js\";\n import {\n@@ -85,7 +85,7 @@ suite(\"Board Actions\", () => {\n       test(\"returns undefined when no URL\", async () => {\n         const graphStore = makeTestGraphStore();\n         const testGraph = makeFreshGraph();\n-        graphStore.set(testGraph);\n+        loadGraphIntoStore(graphStore, testGraph);\n         const editor = editGraphStore(graphStore);\n \n         const { controller } = makeMockController({\n@@ -109,7 +109,7 @@ suite(\"Board Actions\", () => {\n       test(\"returns undefined when readOnly\", async () => {\n         const graphStore = makeTestGraphStore();\n         const testGraph = makeFreshGraph();\n-        graphStore.set(testGraph);\n+        loadGraphIntoStore(graphStore, testGraph);\n         const editor = editGraphStore(graphStore);\n \n         const { controller } = makeMockController({\n@@ -133,7 +133,7 @@ suite(\"Board Actions\", () => {\n       test(\"returns undefined when board server cannot save\", async () => {\n         const graphStore = makeTestGraphStore();\n         const testGraph = makeFreshGraph();\n-        graphStore.set(testGraph);\n+        loadGraphIntoStore(graphStore, testGraph);\n         const editor = editGraphStore(graphStore);\n \n         const { controller } = makeMockController({\n@@ -159,7 +159,7 @@ suite(\"Board Actions\", () => {\n       test(\"calls board server save with graph\", async () => {\n         const graphStore = makeTestGraphStore();\n         const testGraph = makeFreshGraph();\n-        graphStore.set(testGraph);\n+        loadGraphIntoStore(graphStore, testGraph);\n         const editor = editGraphStore(graphStore);\n \n         const mockBoardServer = makeMockBoardServer({ canSave: true });\n@@ -188,7 +188,7 @@ suite(\"Board Actions\", () => {\n       test(\"shows snackbar for user-initiated save\", async () => {\n         const graphStore = makeTestGraphStore();\n         const testGraph = makeFreshGraph();\n-        graphStore.set(testGraph);\n+        loadGraphIntoStore(graphStore, testGraph);\n         const editor = editGraphStore(graphStore);\n \n         const mockBoardServer = makeMockBoardServer({ canSave: true });\n@@ -221,7 +221,7 @@ suite(\"Board Actions\", () => {\n       test(\"returns error result when save throws\", async () => {\n         const graphStore = makeTestGraphStore();\n         const testGraph = makeFreshGraph();\n-        graphStore.set(testGraph);\n+        loadGraphIntoStore(graphStore, testGraph);\n         const editor = editGraphStore(graphStore);\n \n         const mockBoardServer = makeMockBoardServer({\n@@ -387,7 +387,7 @@ suite(\"Board Actions\", () => {\n       const testGraph = makeFreshGraph();\n       testGraph.title = \"My Board\";\n \n-      graphStore.set(testGraph);\n+      loadGraphIntoStore(graphStore, testGraph);\n       const editor = editGraphStore(graphStore);\n \n       const mockBoardServer = makeMockBoardServer({\n@@ -463,7 +463,7 @@ suite(\"Board Actions\", () => {\n       const testGraph = makeFreshGraph();\n       testGraph.title = \"My Board\";\n \n-      graphStore.set(testGraph);\n+      loadGraphIntoStore(graphStore, testGraph);\n       const editor = editGraphStore(graphStore);\n \n       // Mock boardServer that returns no URL (create fails)\ndiff --git a/packages/visual-editor/tests/sca/actions/board/helpers/initialize-editor.test.ts b/packages/visual-editor/tests/sca/actions/board/helpers/initialize-editor.test.ts\nindex d8d12519102..a33c4f6dd3e 100644\n--- a/packages/visual-editor/tests/sca/actions/board/helpers/initialize-editor.test.ts\n+++ b/packages/visual-editor/tests/sca/actions/board/helpers/initialize-editor.test.ts\n@@ -6,18 +6,31 @@\n \n import assert from \"node:assert\";\n import { afterEach, beforeEach, suite, test } from \"node:test\";\n-import type { GraphDescriptor, MutableGraphStore } from \"@breadboard-ai/types\";\n+import type { GraphDescriptor, MutableGraph } from \"@breadboard-ai/types\";\n import {\n   initializeEditor,\n   resetEditor,\n } from \"../../../../../src/sca/actions/board/helpers/initialize-editor.js\";\n import type * as Editor from \"../../../../../src/sca/controller/subcontrollers/editor/editor.js\";\n import { setDOM, unsetDOM } from \"../../../../fake-dom.js\";\n-import { makeTestGraphStore } from \"../../../../helpers/_graph-store.js\";\n+import { makeTestGraphStoreArgs } from \"../../../../helpers/_graph-store.js\";\n \n-function makeMockGraphController(): Editor.Graph.GraphController {\n+const testGraphStoreArgs = makeTestGraphStoreArgs();\n+\n+function makeMockGraphController(): Editor.Graph.GraphController & {\n+  _state: Record<string, unknown>;\n+} {\n+  let mutableGraph: MutableGraph | undefined;\n   const state: Record<string, unknown> = {};\n   return {\n+    // MutableGraphStore implementation — just stores the MutableGraph\n+    set(graph: MutableGraph) {\n+      mutableGraph = graph;\n+    },\n+    get() {\n+      return mutableGraph;\n+    },\n+\n     get id() {\n       return state.id as string;\n     },\n@@ -64,6 +77,7 @@ function makeMockGraphController(): Editor.Graph.GraphController {\n       state.lastLoadedVersion = v;\n     },\n     resetAll: () => {\n+      mutableGraph = undefined;\n       for (const key of Object.keys(state)) {\n         delete state[key];\n       }\n@@ -91,12 +105,10 @@ suite(\"initialize-editor helpers\", () => {\n   });\n \n   test(\"initializes editor with correct state\", () => {\n-    const graphStore = makeTestGraphStore();\n     const graphController = makeMockGraphController();\n     const graph = makeMockGraph();\n-    graphStore.set(graph);\n \n-    const result = initializeEditor(graphStore, graphController, {\n+    const result = initializeEditor(graphController, {\n       graph,\n       moduleId: null,\n       subGraphId: null,\n@@ -104,6 +116,7 @@ suite(\"initialize-editor helpers\", () => {\n       readOnly: false,\n       version: 5,\n       lastLoadedVersion: 3,\n+      graphStoreArgs: testGraphStoreArgs,\n     });\n \n     assert.strictEqual(result.success, true);\n@@ -119,12 +132,10 @@ suite(\"initialize-editor helpers\", () => {\n   });\n \n   test(\"sets graphIsMine to false when readOnly is true\", () => {\n-    const graphStore = makeTestGraphStore();\n     const graphController = makeMockGraphController();\n     const graph = makeMockGraph();\n-    graphStore.set(graph);\n \n-    initializeEditor(graphStore, graphController, {\n+    initializeEditor(graphController, {\n       graph,\n       moduleId: null,\n       subGraphId: null,\n@@ -132,6 +143,7 @@ suite(\"initialize-editor helpers\", () => {\n       readOnly: true,\n       version: 1,\n       lastLoadedVersion: -1,\n+      graphStoreArgs: testGraphStoreArgs,\n     });\n \n     assert.strictEqual(graphController.readOnly, true);\n@@ -139,10 +151,7 @@ suite(\"initialize-editor helpers\", () => {\n   });\n \n   test(\"resetEditor clears controller state\", () => {\n-    const graphController =\n-      makeMockGraphController() as Editor.Graph.GraphController & {\n-        _state: Record<string, unknown>;\n-      };\n+    const graphController = makeMockGraphController();\n \n     // Set some state\n     graphController.url = \"https://example.com/board.json\";\n@@ -153,27 +162,4 @@ suite(\"initialize-editor helpers\", () => {\n     // State should be cleared\n     assert.strictEqual(Object.keys(graphController._state).length, 0);\n   });\n-\n-  test(\"throws when editor cannot be created\", () => {\n-    const graphStore = {\n-      set: () => {},\n-      get: () => undefined,\n-    } as unknown as MutableGraphStore;\n-    const graphController = makeMockGraphController();\n-    const graph = makeMockGraph();\n-\n-    assert.throws(\n-      () =>\n-        initializeEditor(graphStore, graphController, {\n-          graph,\n-          moduleId: null,\n-          subGraphId: null,\n-          url: \"https://example.com/board.json\",\n-          readOnly: false,\n-          version: 1,\n-          lastLoadedVersion: -1,\n-        }),\n-      { message: \"Unable to create editor\" }\n-    );\n-  });\n });\ndiff --git a/packages/visual-editor/tests/sca/actions/graph/graph-actions.test.ts b/packages/visual-editor/tests/sca/actions/graph/graph-actions.test.ts\nindex 5cb14ce2fa4..a11404fa26c 100644\n--- a/packages/visual-editor/tests/sca/actions/graph/graph-actions.test.ts\n+++ b/packages/visual-editor/tests/sca/actions/graph/graph-actions.test.ts\n@@ -9,7 +9,7 @@ import { beforeEach, suite, test } from \"node:test\";\n import * as Graph from \"../../../../src/sca/actions/graph/graph-actions.js\";\n import { AppServices } from \"../../../../src/sca/services/services.js\";\n import { AppController } from \"../../../../src/sca/controller/controller.js\";\n-import { makeTestGraphStore } from \"../../../helpers/_graph-store.js\";\n+import { makeTestGraphStore, loadGraphIntoStore } from \"../../../helpers/_graph-store.js\";\n import { editGraphStore } from \"../../../helpers/_editor.js\";\n import { GraphDescriptor } from \"@breadboard-ai/types\";\n import type { ConfigChangeContext } from \"../../../../src/sca/controller/subcontrollers/editor/graph/graph-controller.js\";\n@@ -77,7 +77,7 @@ suite(\"Graph Actions\", () => {\n       const graphStore = makeTestGraphStore();\n \n       testGraph = graphWithTwoNodes();\n-      graphStore.set(testGraph);\n+      loadGraphIntoStore(graphStore, testGraph);\n       const editor = editGraphStore(graphStore);\n       if (!editor) assert.fail(\"Unable to edit graph\");\n \ndiff --git a/packages/visual-editor/tests/sca/actions/run/run-actions.test.ts b/packages/visual-editor/tests/sca/actions/run/run-actions.test.ts\nindex 04f3b6f76fc..e61cd5c1344 100644\n--- a/packages/visual-editor/tests/sca/actions/run/run-actions.test.ts\n+++ b/packages/visual-editor/tests/sca/actions/run/run-actions.test.ts\n@@ -301,6 +301,29 @@ suite(\"Run Actions\", () => {\n         { id: \"node3\", type: \"test\" },\n       ],\n     };\n+\n+    // Mock controller.editor.graph.get() to return inspectable graph data\n+    (controller.editor.graph as unknown as { get: () => unknown }).get =\n+      () => ({\n+        graphs: new Map([\n+          [\n+            \"\",\n+            {\n+              nodeById: (id: string) => ({\n+                title: () => id,\n+                currentDescribe: () => ({ metadata: { tags: [\"test\"] } }),\n+                currentPorts: () => ({\n+                  inputs: { ports: [] },\n+                  outputs: { ports: [] },\n+                }),\n+                describe: () =>\n+                  Promise.resolve({ metadata: { tags: [\"test\"] } }),\n+              }),\n+            },\n+          ],\n+        ]),\n+      });\n+\n     RunActions.prepare(config);\n \n     // Add some console entries to verify reset\n@@ -635,15 +658,46 @@ suite(\"syncConsoleFromRunner\", () => {\n   test(\"builds console entries from runner plan in execution order\", () => {\n     const { controller } = makeTestController();\n     // Use nodeMetadata option for cleaner mocking\n-    const { services } = makeTestServices({\n-      nodeMetadata: {\n-        \"node-1\": { title: \"Title for node-1\", icon: \"star\", tags: [\"test\"] },\n-        \"node-2\": { title: \"Title for node-2\", icon: \"star\", tags: [\"test\"] },\n-        \"node-3\": { title: \"Title for node-3\", icon: \"star\", tags: [\"test\"] },\n-      },\n-    });\n+    const { services } = makeTestServices({});\n     RunActions.bind({ controller, services });\n \n+    // Mock controller.editor.graph.get() with node metadata\n+    const nodeMetadata: Record<\n+      string,\n+      { title?: string; icon?: string; tags?: string[] }\n+    > = {\n+      \"node-1\": { title: \"Title for node-1\", icon: \"star\", tags: [\"test\"] },\n+      \"node-2\": { title: \"Title for node-2\", icon: \"star\", tags: [\"test\"] },\n+      \"node-3\": { title: \"Title for node-3\", icon: \"star\", tags: [\"test\"] },\n+    };\n+    (controller.editor.graph as unknown as { get: () => unknown }).get =\n+      () => ({\n+        graphs: new Map([\n+          [\n+            \"\",\n+            {\n+              nodeById: (id: string) => {\n+                const meta = nodeMetadata[id] ?? {};\n+                return {\n+                  title: () => meta.title ?? id,\n+                  currentDescribe: () => ({\n+                    metadata: { icon: meta.icon, tags: meta.tags },\n+                  }),\n+                  currentPorts: () => ({\n+                    inputs: { ports: [] },\n+                    outputs: { ports: [] },\n+                  }),\n+                  describe: () =>\n+                    Promise.resolve({\n+                      metadata: { icon: meta.icon, tags: meta.tags },\n+                    }),\n+                };\n+              },\n+            },\n+          ],\n+        ]),\n+      });\n+\n     // Set up a mock runner with a plan\n     const mockRunner = {\n       plan: {\n@@ -701,13 +755,36 @@ suite(\"syncConsoleFromRunner\", () => {\n \n   test(\"maps node state from runner.state\", () => {\n     const { controller } = makeTestController();\n-    const { services } = makeTestServices({\n-      nodeMetadata: {\n-        \"node-1\": { title: \"Node 1\", tags: [\"test\"] },\n-      },\n-    });\n+    const { services } = makeTestServices({});\n     RunActions.bind({ controller, services });\n \n+    // Mock controller.editor.graph.get() with node metadata\n+    (controller.editor.graph as unknown as { get: () => unknown }).get =\n+      () => ({\n+        graphs: new Map([\n+          [\n+            \"\",\n+            {\n+              nodeById: (id: string) => {\n+                if (id === \"node-1\") {\n+                  return {\n+                    title: () => \"Node 1\",\n+                    currentDescribe: () => ({ metadata: { tags: [\"test\"] } }),\n+                    currentPorts: () => ({\n+                      inputs: { ports: [] },\n+                      outputs: { ports: [] },\n+                    }),\n+                    describe: () =>\n+                      Promise.resolve({ metadata: { tags: [\"test\"] } }),\n+                  };\n+                }\n+                return undefined;\n+              },\n+            },\n+          ],\n+        ]),\n+      });\n+\n     // Set up a mock runner with state\n     const mockRunner = {\n       plan: {\n@@ -739,13 +816,36 @@ suite(\"syncConsoleFromRunner\", () => {\n \n   test(\"defaults to 'inactive' when node has no state\", () => {\n     const { controller } = makeTestController();\n-    const { services } = makeTestServices({\n-      nodeMetadata: {\n-        \"node-1\": { title: \"Node 1\", tags: [\"test\"] },\n-      },\n-    });\n+    const { services } = makeTestServices({});\n     RunActions.bind({ controller, services });\n \n+    // Mock controller.editor.graph.get() with node metadata\n+    (controller.editor.graph as unknown as { get: () => unknown }).get =\n+      () => ({\n+        graphs: new Map([\n+          [\n+            \"\",\n+            {\n+              nodeById: (id: string) => {\n+                if (id === \"node-1\") {\n+                  return {\n+                    title: () => \"Node 1\",\n+                    currentDescribe: () => ({ metadata: { tags: [\"test\"] } }),\n+                    currentPorts: () => ({\n+                      inputs: { ports: [] },\n+                      outputs: { ports: [] },\n+                    }),\n+                    describe: () =>\n+                      Promise.resolve({ metadata: { tags: [\"test\"] } }),\n+                  };\n+                }\n+                return undefined;\n+              },\n+            },\n+          ],\n+        ]),\n+      });\n+\n     const mockRunner = {\n       plan: {\n         stages: [[{ node: { id: \"node-1\" } }]],\n@@ -815,8 +915,9 @@ suite(\"syncConsoleFromRunner\", () => {\n \n     (controller.editor.graph as { editor: unknown }).editor = mockEditor;\n \n-    // GraphStore returns null for get() (no graph store set up)\n-    (services.graphStore as unknown as { get: () => unknown }).get = () => null;\n+    // Controller's graph returns null for get() (no graph store set up)\n+    (controller.editor.graph as unknown as { get: () => unknown }).get = () =>\n+      null;\n \n     assert.doesNotThrow(() => {\n       RunActions.syncConsoleFromRunner();\n@@ -851,9 +952,10 @@ suite(\"syncConsoleFromRunner\", () => {\n       nodeById: () => undefined, // Node not found\n     };\n \n-    (services.graphStore as unknown as { get: () => unknown }).get = () => ({\n-      graphs: new Map([[\"\", mockInspectable]]),\n-    });\n+    (controller.editor.graph as unknown as { get: () => unknown }).get =\n+      () => ({\n+        graphs: new Map([[\"\", mockInspectable]]),\n+      });\n \n     RunActions.syncConsoleFromRunner();\n \n@@ -884,9 +986,10 @@ suite(\"syncConsoleFromRunner\", () => {\n \n     (controller.editor.graph as { editor: unknown }).editor = mockEditor;\n \n-    (services.graphStore as unknown as { get: () => unknown }).get = () => ({\n-      graphs: new Map([[\"\", { nodeById: () => undefined }]]),\n-    });\n+    (controller.editor.graph as unknown as { get: () => unknown }).get =\n+      () => ({\n+        graphs: new Map([[\"\", { nodeById: () => undefined }]]),\n+      });\n \n     assert.doesNotThrow(() => {\n       RunActions.syncConsoleFromRunner();\n@@ -1138,9 +1241,10 @@ suite(\"syncConsoleFromRunner async describe\", () => {\n     const mockInspectable = {\n       nodeById: () => mockNode,\n     };\n-    (services.graphStore as unknown as { get: () => unknown }).get = () => ({\n-      graphs: new Map([[\"\", mockInspectable]]),\n-    });\n+    (controller.editor.graph as unknown as { get: () => unknown }).get =\n+      () => ({\n+        graphs: new Map([[\"\", mockInspectable]]),\n+      });\n \n     RunActions.syncConsoleFromRunner();\n \n@@ -1190,9 +1294,10 @@ suite(\"syncConsoleFromRunner async describe\", () => {\n     (controller.editor.graph as { editor: unknown }).editor = mockEditor;\n \n     const mockInspectable = { nodeById: () => mockNode };\n-    (services.graphStore as unknown as { get: () => unknown }).get = () => ({\n-      graphs: new Map([[\"\", mockInspectable]]),\n-    });\n+    (controller.editor.graph as unknown as { get: () => unknown }).get =\n+      () => ({\n+        graphs: new Map([[\"\", mockInspectable]]),\n+      });\n \n     RunActions.syncConsoleFromRunner();\n \n@@ -1226,9 +1331,10 @@ suite(\"syncConsoleFromRunner async describe\", () => {\n \n     // Mock nodeById to return null\n     const mockInspectable = { nodeById: () => null };\n-    (services.graphStore as unknown as { get: () => unknown }).get = () => ({\n-      graphs: new Map([[\"\", mockInspectable]]),\n-    });\n+    (controller.editor.graph as unknown as { get: () => unknown }).get =\n+      () => ({\n+        graphs: new Map([[\"\", mockInspectable]]),\n+      });\n \n     // Should not throw\n     assert.doesNotThrow(() => {\ndiff --git a/packages/visual-editor/tests/sca/controller/subcontrollers/editor/graph/graph-controller.test.ts b/packages/visual-editor/tests/sca/controller/subcontrollers/editor/graph/graph-controller.test.ts\nindex 1b4d9e42283..dce2e1f8cf9 100644\n--- a/packages/visual-editor/tests/sca/controller/subcontrollers/editor/graph/graph-controller.test.ts\n+++ b/packages/visual-editor/tests/sca/controller/subcontrollers/editor/graph/graph-controller.test.ts\n@@ -7,12 +7,14 @@\n import assert from \"node:assert\";\n import { beforeEach, suite, test } from \"node:test\";\n import { GraphController } from \"../../../../../../src/sca/controller/subcontrollers/editor/graph/graph-controller.js\";\n-import { makeTestGraphStore } from \"../../../../../helpers/_graph-store.js\";\n+import {\n+  makeTestGraphStore,\n+  loadGraphIntoStore,\n+} from \"../../../../../helpers/_graph-store.js\";\n import { editGraphStore } from \"../../../../../helpers/_editor.js\";\n-import { EditableGraph } from \"@breadboard-ai/types\";\n+import { EditableGraph, MutableGraphStore } from \"@breadboard-ai/types\";\n import { ok } from \"@breadboard-ai/utils\";\n import { unwrap } from \"../../../../../../src/sca/controller/decorators/utils/wrap-unwrap.js\";\n-import { GraphStore } from \"../../../../../../src/engine/inspector/graph-store.js\";\n import { Tab } from \"../../../../../../src/runtime/types.js\";\n import { createMockEditor, makeFreshGraph } from \"../../../../helpers/index.js\";\n import { A2_TOOLS } from \"../../../../../../src/a2/a2-registry.js\";\n@@ -20,13 +22,13 @@ import { A2_TOOLS } from \"../../../../../../src/a2/a2-registry.js\";\n suite(\"GraphController\", () => {\n   let testGraph = makeFreshGraph();\n   let editableGraph: EditableGraph | undefined;\n-  let graphStore: GraphStore;\n+  let graphStore: MutableGraphStore;\n \n   beforeEach(() => {\n     graphStore = makeTestGraphStore();\n \n     testGraph = makeFreshGraph();\n-    graphStore.set(testGraph);\n+    loadGraphIntoStore(graphStore, testGraph);\n     editableGraph = editGraphStore(graphStore);\n     if (!editableGraph) assert.fail(\"Unable to edit graph\");\n   });\n@@ -50,7 +52,7 @@ suite(\"GraphController\", () => {\n     store.setEditor(editableGraph);\n \n     // Make a new one and apply it.\n-    graphStore.set(makeFreshGraph());\n+    loadGraphIntoStore(graphStore, makeFreshGraph());\n     const editableGraphAlt = editGraphStore(graphStore);\n     if (!editableGraphAlt) assert.fail(\"No editable graph\");\n \n@@ -208,7 +210,7 @@ suite(\"GraphController\", () => {\n       },\n     };\n \n-    graphStore.set(graphWithSubGraphs);\n+    loadGraphIntoStore(graphStore, graphWithSubGraphs);\n     const editable = editGraphStore(graphStore);\n     if (!editable) assert.fail(\"Unable to edit graph\");\n \n@@ -264,7 +266,7 @@ suite(\"GraphController\", () => {\n       },\n     };\n \n-    graphStore.set(graphWithSubGraphs);\n+    loadGraphIntoStore(graphStore, graphWithSubGraphs);\n     const editable = editGraphStore(graphStore);\n     if (!editable) assert.fail(\"Unable to edit graph\");\n \n@@ -456,7 +458,7 @@ suite(\"GraphController\", () => {\n       ],\n     };\n \n-    graphStore.set(graphWithNodes);\n+    loadGraphIntoStore(graphStore, graphWithNodes);\n     const editable = editGraphStore(graphStore);\n     if (!editable) assert.fail(\"Unable to edit graph\");\n \n@@ -512,7 +514,7 @@ suite(\"GraphController\", () => {\n       ...makeFreshGraph(),\n       nodes: [{ id: \"first-node\", type: \"input\" }],\n     };\n-    graphStore.set(graph1);\n+    loadGraphIntoStore(graphStore, graph1);\n     const editable1 = editGraphStore(graphStore);\n     if (!editable1) assert.fail(\"Unable to edit graph 1\");\n \n@@ -524,7 +526,7 @@ suite(\"GraphController\", () => {\n       ...makeFreshGraph(),\n       nodes: [{ id: \"second-node\", type: \"output\" }],\n     };\n-    graphStore.set(graph2);\n+    loadGraphIntoStore(graphStore, graph2);\n     const editable2 = editGraphStore(graphStore);\n     if (!editable2) assert.fail(\"Unable to edit graph 2\");\n \n@@ -558,7 +560,7 @@ suite(\"GraphController\", () => {\n       },\n     };\n \n-    graphStore.set(graphWithUntitledSubGraph);\n+    loadGraphIntoStore(graphStore, graphWithUntitledSubGraph);\n     const editable = editGraphStore(graphStore);\n     if (!editable) assert.fail(\"Unable to edit graph\");\n \n@@ -585,7 +587,7 @@ suite(\"GraphController\", () => {\n       nodes: [{ id: \"test-component-node\", type: \"input\" }],\n     };\n \n-    graphStore.set(graphWithNode);\n+    loadGraphIntoStore(graphStore, graphWithNode);\n     const editable = editGraphStore(graphStore);\n     if (!editable) assert.fail(\"Unable to edit graph\");\n \ndiff --git a/packages/visual-editor/tests/sca/controller/subcontrollers/editor/selection/selection-controller.test.ts b/packages/visual-editor/tests/sca/controller/subcontrollers/editor/selection/selection-controller.test.ts\nindex 509503ab217..7d43b862793 100644\n--- a/packages/visual-editor/tests/sca/controller/subcontrollers/editor/selection/selection-controller.test.ts\n+++ b/packages/visual-editor/tests/sca/controller/subcontrollers/editor/selection/selection-controller.test.ts\n@@ -9,7 +9,7 @@ import { suite, test } from \"node:test\";\n import { SelectionController } from \"../../../../../../src/sca/controller/subcontrollers/editor/selection/selection-controller.js\";\n import { GraphDescriptor } from \"@breadboard-ai/types\";\n import { unwrap } from \"../../../../../../src/sca/controller/decorators/utils/wrap-unwrap.js\";\n-import { makeTestGraphStore } from \"../../../../../helpers/_graph-store.js\";\n+import { makeTestGraphStore, loadGraphIntoStore } from \"../../../../../helpers/_graph-store.js\";\n import { toEdgeIdentifier } from \"../../../../../../src/sca/utils/helpers/helpers.js\";\n \n const testGraph: GraphDescriptor & Required<Pick<GraphDescriptor, \"assets\">> = {\n@@ -204,7 +204,7 @@ suite(\"SelectionController\", () => {\n \n     const graphStore = makeTestGraphStore();\n \n-    graphStore.set(testGraph);\n+    loadGraphIntoStore(graphStore, testGraph);\n     const inspectableGraph = graphStore.get()?.graphs.get(\"\");\n     if (!inspectableGraph) assert.fail(\"Unable to inspect graph\");\n \ndiff --git a/packages/visual-editor/tests/sca/helpers/index.ts b/packages/visual-editor/tests/sca/helpers/index.ts\nindex c0d1933be74..9f425723c99 100644\n--- a/packages/visual-editor/tests/sca/helpers/index.ts\n+++ b/packages/visual-editor/tests/sca/helpers/index.ts\n@@ -34,7 +34,7 @@ export {\n } from \"./mock-services.js\";\n \n import type { FlowGenerator } from \"../../../src/ui/flow-gen/flow-generator.js\";\n-import type { AppServices } from \"../../../src/sca/services/services.js\";\n+\n import { makeTestController } from \"./mock-controller.js\";\n import {\n   makeTestServices,\n@@ -61,20 +61,17 @@ export interface TestFixturesOptions {\n export function makeTestFixtures(options: TestFixturesOptions = {}) {\n   const { withEditor = false, flowGeneratorMock, agentContext } = options;\n \n-  let graphStore: AppServices[\"graphStore\"] | undefined;\n   let editor:\n     | ReturnType<typeof makeTestGraphStoreWithEditor>[\"editor\"]\n     | undefined;\n \n   if (withEditor) {\n     const result = makeTestGraphStoreWithEditor();\n-    graphStore = result.graphStore;\n     editor = result.editor;\n   }\n \n   const { controller, mocks: controllerMocks } = makeTestController({ editor });\n   const { services, mocks: serviceMocks } = makeTestServices({\n-    graphStore,\n     flowGeneratorMock,\n     agentContext,\n   });\ndiff --git a/packages/visual-editor/tests/sca/helpers/mock-controller.ts b/packages/visual-editor/tests/sca/helpers/mock-controller.ts\nindex 3694caa1b01..ef12ffed0ee 100644\n--- a/packages/visual-editor/tests/sca/helpers/mock-controller.ts\n+++ b/packages/visual-editor/tests/sca/helpers/mock-controller.ts\n@@ -121,7 +121,14 @@ export function makeTestController(options: TestControllerOptions = {}) {\n       init: () => {},\n     },\n     editor: {\n-      graph: editor ? { editor, lastNodeConfigChange: null } : graph,\n+      graph: editor\n+        ? {\n+            editor,\n+            lastNodeConfigChange: null,\n+            get: () => undefined,\n+            set: () => {},\n+          }\n+        : { ...graph, get: () => undefined, set: () => {} },\n       selection: {\n         selectionId: 0,\n       },\ndiff --git a/packages/visual-editor/tests/sca/helpers/mock-services.ts b/packages/visual-editor/tests/sca/helpers/mock-services.ts\nindex cfc713c504e..e90516ae626 100644\n--- a/packages/visual-editor/tests/sca/helpers/mock-services.ts\n+++ b/packages/visual-editor/tests/sca/helpers/mock-services.ts\n@@ -10,7 +10,10 @@ import type { GuestConfiguration } from \"@breadboard-ai/types/opal-shell-protoco\n import { AppServices } from \"../../../src/sca/services/services.js\";\n import type { GlobalConfig } from \"../../../src/ui/contexts/global-config.js\";\n import type { FlowGenerator } from \"../../../src/ui/flow-gen/flow-generator.js\";\n-import { makeTestGraphStore } from \"../../helpers/_graph-store.js\";\n+import {\n+  makeTestGraphStore,\n+  loadGraphIntoStore,\n+} from \"../../helpers/_graph-store.js\";\n import { editGraphStore } from \"../../helpers/_editor.js\";\n import type { GoogleDriveClient } from \"@breadboard-ai/utils/google-drive/google-drive-client.js\";\n import type { SigninAdapter } from \"../../../src/ui/utils/signin-adapter.js\";\n@@ -30,7 +33,7 @@ const defaultAgentContext = {\n export function makeTestGraphStoreWithEditor() {\n   const graphStore = makeTestGraphStore();\n   const testGraph: GraphDescriptor = { nodes: [], edges: [] };\n-  graphStore.set(testGraph);\n+  loadGraphIntoStore(graphStore, testGraph);\n   const editor = editGraphStore(graphStore);\n   if (!editor) throw new Error(\"Unable to edit graph\");\n   return { graphStore, editor };\n@@ -144,13 +147,7 @@ export function makeMockBoardServer(options: {\n \n export interface TestServicesOptions {\n   agentContext?: typeof defaultAgentContext;\n-  graphStore?: AppServices[\"graphStore\"];\n   flowGeneratorMock?: Partial<FlowGenerator>;\n-  /** Custom metadata for mock nodes - keyed by node ID */\n-  nodeMetadata?: Record<\n-    string,\n-    { title?: string; icon?: string; tags?: string[] }\n-  >;\n   googleDriveClient?: Partial<GoogleDriveClient>;\n   signinAdapter?: Partial<SigninAdapter>;\n   googleDriveBoardServer?: Partial<\n@@ -165,9 +162,7 @@ export interface TestServicesOptions {\n export function makeTestServices(options: TestServicesOptions = {}) {\n   const {\n     agentContext = defaultAgentContext,\n-    graphStore,\n     flowGeneratorMock,\n-    nodeMetadata = {},\n     googleDriveClient,\n     signinAdapter,\n     googleDriveBoardServer,\n@@ -204,43 +199,6 @@ export function makeTestServices(options: TestServicesOptions = {}) {\n         return { runner: mockRunner, abortController };\n       },\n     },\n-    // graphStore - use provided or default mock\n-    graphStore:\n-      graphStore ??\n-      ({\n-        fileSystem: {\n-          env: () => [],\n-          createRunFileSystem: () => ({}),\n-        },\n-        // For nodestart event handling\n-        get: () => ({\n-          graphs: new Map([\n-            [\n-              \"\",\n-              {\n-                nodeById: (id: string) => {\n-                  const meta = nodeMetadata[id] ?? {};\n-                  return {\n-                    title: () => meta.title ?? id,\n-                    currentDescribe: () => ({\n-                      metadata: { icon: meta.icon, tags: meta.tags },\n-                    }),\n-                    currentPorts: () => ({\n-                      inputs: { ports: [] },\n-                      outputs: { ports: [] },\n-                    }),\n-                    // For async describe fallback - include tags to skip this branch\n-                    describe: () =>\n-                      Promise.resolve({\n-                        metadata: { icon: meta.icon, tags: meta.tags },\n-                      }),\n-                  };\n-                },\n-              },\n-            ],\n-          ]),\n-        }),\n-      } as unknown as AppServices[\"graphStore\"]),\n     // Mock loader for run actions\n     loader: {} as unknown as AppServices[\"loader\"],\n     // Mock sandbox for run config\n"
test_patch: ''
fail_to_pass: []
pass_to_pass:
- cd packages/visual-editor && npm run build:tsc && node --import ./tests/controller-setup.js --test-reporter=spec --test --enable-source-maps ./dist/tsc/tests/sca/actions/board/helpers/initialize-editor.test.js
install_config:
  install: npm install
  node: '20'
  test_cmd: npm test
meta:
  added_lines: '330'
  difficulty: hard
  files_changed: '27'
  pr_title: graph store no more
  removed_lines: '549'
  source: gh-archive-pr
  test_generation: agentic
prompt: |-
  breadboard-ai/breadboard (#7818): graph store no more

  Update the editor to eliminate the GraphStore concept. The editor should construct and manage a MutableGraph directly during initialization, and any public API or behavior that previously exposed GraphStore (including its types property or EventTarget-like behavior) should be removed. Ensure the resulting behavior uses MutableGraph without requiring or referencing GraphStore.
original_pr_body: |
  breadboard-ai/breadboard (#7818): graph store no more

  - **Remove the `GraphStore.types` property.**
  - **Make `GraphStore` not an EventTarget**
  - **Remove `GraphStore`.**
  - **Start constructing `MutableGraph` in `initializeEditor`.**
quality_score: 0.78
quality_passed: true
docker_passed: false
workspace_path: null
status: ready
