id: JovieInc/Jovie-3440
repo: JovieInc/Jovie
base_commit: a9c7231216fbe8da67b4f6194be77b8cb9eb2238
merge_commit: ba02ac1dd2bfa955a8514bf5cd63ff6d3f3d24b8
language: typescript
difficulty_score: 2
created_at: 2026-02-14T14:32:37.048077632Z
patch: "diff --git a/apps/web/components/organisms/release-sidebar/ReleaseSettings.tsx b/apps/web/components/organisms/release-sidebar/ReleaseSettings.tsx\nindex 25d5eacb6..09de3292f 100644\n--- a/apps/web/components/organisms/release-sidebar/ReleaseSettings.tsx\n+++ b/apps/web/components/organisms/release-sidebar/ReleaseSettings.tsx\n@@ -8,7 +8,7 @@\n  */\n \n import { Switch } from '@jovie/ui';\n-import { useCallback, useId, useState, useTransition } from 'react';\n+import { useCallback, useId, useState } from 'react';\n import { toast } from 'sonner';\n import { updateAllowArtworkDownloads } from '@/app/app/(shell)/dashboard/releases/actions';\n import {\n@@ -25,29 +25,27 @@ export function ReleaseSettings({\n   allowDownloads: initialAllowDownloads,\n }: ReleaseSettingsProps) {\n   const [allowDownloads, setAllowDownloads] = useState(initialAllowDownloads);\n-  const [isPending, startTransition] = useTransition();\n+  const [isPending, setIsPending] = useState(false);\n   const switchId = useId();\n \n-  const handleToggle = useCallback(\n-    (checked: boolean) => {\n-      setAllowDownloads(checked);\n-      startTransition(async () => {\n-        try {\n-          await updateAllowArtworkDownloads(checked);\n-          toast.success(\n-            checked\n-              ? 'Artwork downloads enabled for visitors'\n-              : 'Artwork downloads disabled'\n-          );\n-        } catch {\n-          // Revert on failure\n-          setAllowDownloads(!checked);\n-          toast.error('Failed to update setting');\n-        }\n-      });\n-    },\n-    [startTransition]\n-  );\n+  const handleToggle = useCallback(async (checked: boolean) => {\n+    setAllowDownloads(checked);\n+    setIsPending(true);\n+    try {\n+      await updateAllowArtworkDownloads(checked);\n+      toast.success(\n+        checked\n+          ? 'Artwork downloads enabled for visitors'\n+          : 'Artwork downloads disabled'\n+      );\n+    } catch {\n+      // Revert on failure\n+      setAllowDownloads(!checked);\n+      toast.error('Failed to update setting');\n+    } finally {\n+      setIsPending(false);\n+    }\n+  }, []);\n \n   return (\n     <DrawerSection title='Settings'>\n"
test_patch: ''
fail_to_pass: []
pass_to_pass:
- pnpm --filter=@jovie/web test -- --run --reporter=dot tests/unit/LoadingSpinner.test.tsx
install_config:
  install: npm install
  node: '20'
  test_cmd: npm test
meta:
  added_lines: '20'
  difficulty: medium
  files_changed: '1'
  pr_title: Refactor ReleaseSettings to use manual state instead of useTransition
  removed_lines: '22'
  source: gh-archive-pr
  test_generation: agentic
prompt: |-
  JovieInc/Jovie (#3440): Refactor ReleaseSettings to use manual state instead of useTransition

  Update the Release Settings UI to manage its pending/loading state explicitly without relying on React transition hooks. The component should continue to show correct loading behavior during async operations, recover state properly on failures, and provide clear success/error feedback to users when configuration changes are applied. Preserve existing user-facing behavior aside from the state management approach.
original_pr_body: |-
  JovieInc/Jovie (#3440): Refactor ReleaseSettings to use manual state instead of useTransition

  ## Description

  Refactored the `ReleaseSettings` component to replace React's `useTransition` hook with manual state management using `useState`. The async handler now explicitly manages the `isPending` state with `setIsPending` calls, making the loading state transitions more explicit and easier to follow.

  ## Type of Change

  - [x] Refactoring (no functional changes)

  ## Testing

  - [x] No testing needed - this is a straightforward refactor that maintains existing functionality

  ## Code Quality

  - [x] Code follows project style guidelines
  - [x] Self-review completed
  - [x] TypeScript types are properly defined

  ## Checklist

  - [x] PR title follows conventional commit format
  - [x] All CI checks pass

  ## Notes

  This change simplifies the component by:
  1. Removing the `useTransition` hook dependency
  2. Using explicit `setIsPending(true)` at the start and `setIsPending(false)` in the finally block
  3. Reducing the dependency array from `[startTransition]` to `[]` since we're no longer using that function
  4. Making the async flow more straightforward and easier to understand

  https://claude.ai/code/session_01HpGpxcGqVtxwLXzGwwf3dV

  <!-- This is an auto-generated comment: release notes by coderabbit.ai -->

  ## Summary by CodeRabbit

  * **Improvements**
    * Enhanced error handling in release settings with automatic state recovery on operation failures and improved user feedback.
    * Added success and error notifications to provide clear feedback when configuration changes are applied or encounter issues.
    * More reliable and stable async operation handling in the settings interface with improved state management.

  <!-- end of auto-generated comment: release notes by coderabbit.ai -->
quality_score: 0.5
quality_passed: true
docker_passed: false
workspace_path: null
status: ready
